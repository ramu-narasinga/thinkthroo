{
  "title": "Maintenance mode check in Next.js middleware.ts\r",
  "published": false,
  "featured": false,
  "component": false,
  "toc": true,
  "body": {
    "raw": "\r\nIn this article, we review the code related to maintenance mode check in [Grida source code](https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14), but first we need to understand what a maintenance mode is in Vercel.\r\n\r\n![](https://cdn-images-1.medium.com/max/1600/1*xiYyTyRKUGmYqT9EbD_Rpw.png)\r\n\r\n### Maintenance mode in Vercel\r\n\r\nI am quoting the documentation found in [Maintenance Page Example](https://vercel.com/templates/next.js/maintenance-page)  \r\nbelow:\r\n\r\n> When we do a release, promotion, event, etc. that might bring more attention than usual to a page; \r\n\r\nIts a good idea to have a backup plan that includes showing a different page to the users in case something fails. If this page receives a lot of traffic, we can use the edge, a previously generated static page and Edge Config to give the users dynamic at the speed of static.\r\n\r\nYou would use Maintenance Page when you want to change the flow of the traffic quickly in case something fails, but how to do it?\r\n\r\n#### Detect if your app is in maintenance mode\r\n\r\nThe below code is picked from the [Maintenance Page example](https://edge-maintenance-page.vercel.app/).\r\n\r\n```js\r\nimport { NextRequest, NextResponse } from 'next/server'\r\nimport { get } from '@vercel/edge-config'\r\n\r\nexport const config = {\r\n matcher: '/big-promo',\r\n}\r\n\r\nexport async function middleware(req: NextRequest) {\r\n  // Check Edge Config to see if the maintenance page should be shown\r\n  const isInMaintenanceMode = await get('isInMaintenanceMode')\r\n  // If in maintenance mode, point the url pathname to the maintenance page\r\n  if (isInMaintenanceMode) {\r\n    req.nextUrl.pathname = `/maintenance`\r\n    // Rewrite to the url\r\n    return NextResponse.rewrite(req.nextUrl)\r\n  }\r\n}\r\n```\r\n\r\nHere the most important check is about maintenance mode\r\n\r\n```js\r\n// Check Edge Config to see if the maintenance page should be shown\r\nconst isInMaintenanceMode = await get('isInMaintenanceMode')\r\n```\r\n\r\nThen if your project is in maintenance mode, you would do something like below, to show the maintenance page:\r\n\r\n```js\r\n// If in maintenance mode, point the url pathname to the maintenance page\r\nif (isInMaintenanceMode) {\r\n  req.nextUrl.pathname = `/maintenance`\r\n  // Rewrite to the url\r\n  return NextResponse.rewrite(req.nextUrl)\r\n}\r\n```\r\n\r\n### Github discussion:\r\n\r\nThere is a [discussion on Github](https://github.com/vercel/next.js/discussions/12850) about Maintenance mode in Vercel.\r\n\r\nSome suggestions involve using redirects in next.config.ts depending on an enviroment variable called MAINTENANCE\\_MODE but what folows that is a conversation about how this be indexed by Google and for that reason, [comment](https://github.com/vercel/next.js/discussions/12850#discussioncomment-3335807) suggests to add `<meta name=”robots” content=”noindex” />`\r\n\r\nThe [accepted answer](https://github.com/vercel/next.js/discussions/12850#discussioncomment-5611009) points to the [Maintenance page example](https://vercel.com/templates/next.js/maintenance-page).\r\n\r\n### Maintenance mode check in Grida Form\r\n\r\nThe below code is picked from [forms/middleware.ts](https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14)\r\n\r\n```js\r\nexport async function middleware(req: NextRequest) {\r\n  // #region maintenance mode\r\n  if (process.env.NODE_ENV === \"production\") {\r\n    try {\r\n      // Check whether the maintenance page should be shown\r\n      const isInMaintenanceMode = await get<boolean>(\"IS_IN_MAINTENANCE_MODE\");\r\n\r\n      // If is in maintenance mode, point the url pathname to the maintenance page\r\n      if (isInMaintenanceMode) {\r\n        req.nextUrl.pathname = `/maintenance`;\r\n\r\n        // Rewrite to the url\r\n        return NextResponse.rewrite(req.nextUrl);\r\n      }\r\n    } catch (error) {\r\n      // show the default page if EDGE_CONFIG env var is missing,\r\n      // but log the error to the console\r\n      console.error(error);\r\n    }\r\n  }\r\n  // #endregion maintenance mode\r\n```\r\n\r\nThis code handles the maintenance mode exactly as what is provided in the Vercel’s example, but there are slight differences:\r\n\r\n1. Try/catch block\r\n    \r\n2. process.env.NODE\\_ENV check\r\n    \r\n\r\nThis defensive mechanism is important to handle any unexpected errors and that to apply the maintenance mode only in production.\r\n\r\n### About me:\r\n\r\nHey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\r\n\r\nI am open to work on interesting projects. Send me an email at ramu.narasinga@gmail.com\r\n\r\nMy Github —  [https://github.com/ramu-narasinga](https://github.com/ramu-narasinga)\r\n\r\nMy website —  [https://ramunarasinga.com](https://ramunarasinga.com/)\r\n\r\nMy Youtube channel —  [https://www.youtube.com/@thinkthroo](https://www.youtube.com/@thinkthroo)\r\n\r\nLearning platform —  [https://thinkthroo.com](https://thinkthroo.com/)\r\n\r\nCodebase Architecture —  [https://app.thinkthroo.com/architecture](https://app.thinkthroo.com/architecture)\r\n\r\nBest practices —  [https://app.thinkthroo.com/best-practices](https://app.thinkthroo.com/best-practices)\r\n\r\nProduction-grade projects —  [https://app.thinkthroo.com/production-grade-projects](https://app.thinkthroo.com/production-grade-projects)\r\n\r\n### References:\r\n\r\n1. [https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14](https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14)\r\n    \r\n2. [https://github.com/vercel/next.js/discussions/12850](https://github.com/vercel/next.js/discussions/12850)\r\n    \r\n3. [https://vercel.com/templates/next.js/maintenance-page](https://vercel.com/templates/next.js/maintenance-page)\r\n    \r\n4. [https://github.com/vercel/next.js/discussions/12850#discussioncomment-3335807](https://github.com/vercel/next.js/discussions/12850#discussioncomment-3335807)\r\n    \r\n5. [https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14](https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14)",
    "code": "var Component=(()=>{var d=Object.create;var r=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var g=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),f=(l,e)=>{for(var c in e)r(l,c,{get:e[c],enumerable:!0})},o=(l,e,c,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of m(e))!u.call(l,s)&&s!==c&&r(l,s,{get:()=>e[s],enumerable:!(a=p(e,s))||a.enumerable});return l};var b=(l,e,c)=>(c=l!=null?d(y(l)):{},o(e||!l||!l.__esModule?r(c,\"default\",{value:l,enumerable:!0}):c,l)),N=l=>o(r({},\"__esModule\",{value:!0}),l);var i=g((M,t)=>{t.exports=_jsx_runtime});var x={};f(x,{default:()=>h,frontmatter:()=>w});var n=b(i()),w={title:\"Maintenance mode check in Next.js middleware.ts\"};function F(l){let e={a:\"a\",blockquote:\"blockquote\",br:\"br\",code:\"code\",div:\"div\",h3:\"h3\",h4:\"h4\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",...l.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"In this article, we review the code related to maintenance mode check in \",(0,n.jsx)(e.a,{href:\"https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14\",children:\"Grida source code\"}),\", but first we need to understand what a maintenance mode is in Vercel.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://cdn-images-1.medium.com/max/1600/1*xiYyTyRKUGmYqT9EbD_Rpw.png\",alt:\"\"})}),`\n`,(0,n.jsx)(e.h3,{id:\"maintenance-mode-invercel\",children:\"Maintenance mode in\\xA0Vercel\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I am quoting the documentation found in \",(0,n.jsx)(e.a,{href:\"https://vercel.com/templates/next.js/maintenance-page\",children:\"Maintenance Page Example\"}),(0,n.jsx)(e.br,{}),`\n`,\"below:\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:\"When we do a release, promotion, event, etc. that might bring more attention than usual to a page;\\xA0\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Its a good idea to have a backup plan that includes showing a different page to the users in case something fails. If this page receives a lot of traffic, we can use the edge, a previously generated static page and Edge Config to give the users dynamic at the speed of static.\"}),`\n`,(0,n.jsx)(e.p,{children:\"You would use Maintenance Page when you want to change the flow of the traffic quickly in case something fails, but how to do it?\"}),`\n`,(0,n.jsx)(e.h4,{id:\"detect-if-your-app-is-in-maintenance-mode\",children:\"Detect if your app is in maintenance mode\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The below code is picked from the \",(0,n.jsx)(e.a,{href:\"https://edge-maintenance-page.vercel.app/\",children:\"Maintenance Page example\"}),\".\"]}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"js\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"js\",\"data-theme\":\"default\",children:[(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"import\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextRequest\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextResponse \"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" from\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" 'next/server'\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"import\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" get \"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" from\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" '@vercel/edge-config'\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"export\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" const\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" config \"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" matcher\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" '/big-promo'\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"export\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" async\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" function\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" middleware\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"req\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" NextRequest\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" Check Edge Config to see if the maintenance page should be shown\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  const\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" isInMaintenanceMode \"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" await\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" get\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"'isInMaintenanceMode'\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" If in maintenance mode, point the url pathname to the maintenance page\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  if\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" (\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"isInMaintenanceMode\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"    req\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"nextUrl\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"pathname \"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" `/maintenance`\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" Rewrite to the url\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    return\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextResponse\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"rewrite\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"req\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"nextUrl\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  }\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"})})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Here the most important check is about maintenance mode\"}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"js\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"js\",\"data-theme\":\"default\",children:[(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"//\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" Check Edge Config to see if the maintenance page should be shown\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"const\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" isInMaintenanceMode \"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" await\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" get\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"'isInMaintenanceMode'\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"})]})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Then if your project is in maintenance mode, you would do something like below, to show the maintenance page:\"}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"js\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"js\",\"data-theme\":\"default\",children:[(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"//\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" If in maintenance mode, point the url pathname to the maintenance page\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"if\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" (\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"isInMaintenanceMode\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"  req\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"nextUrl\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"pathname \"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" `/maintenance`\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" Rewrite to the url\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  return\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextResponse\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"rewrite\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"req\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"nextUrl\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"})})]})})}),`\n`,(0,n.jsx)(e.h3,{id:\"github-discussion\",children:\"Github discussion:\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"There is a \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/discussions/12850\",children:\"discussion on Github\"}),\" about Maintenance mode in Vercel.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Some suggestions involve using redirects in next.config.ts depending on an enviroment variable called MAINTENANCE_MODE but what folows that is a conversation about how this be indexed by Google and for that reason, \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/discussions/12850#discussioncomment-3335807\",children:\"comment\"}),\" suggests to add \",(0,n.jsx)(e.code,{children:\"<meta name=\\u201Drobots\\u201D content=\\u201Dnoindex\\u201D />\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/discussions/12850#discussioncomment-5611009\",children:\"accepted answer\"}),\" points to the \",(0,n.jsx)(e.a,{href:\"https://vercel.com/templates/next.js/maintenance-page\",children:\"Maintenance page example\"}),\".\"]}),`\n`,(0,n.jsx)(e.h3,{id:\"maintenance-mode-check-in-gridaform\",children:\"Maintenance mode check in Grida\\xA0Form\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The below code is picked from \",(0,n.jsx)(e.a,{href:\"https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14\",children:\"forms/middleware.ts\"})]}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"js\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"js\",\"data-theme\":\"default\",children:[(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"export\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" async\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" function\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" middleware\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"req\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" NextRequest\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" #region maintenance mode\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  if\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" (\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"process\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"env\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"NODE_ENV \"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"===\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:' \"production\"'}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    try\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"      //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" Check whether the maintenance page should be shown\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"      const\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" isInMaintenanceMode \"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" await\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" get\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"<\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"boolean\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\">(\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:'\"IS_IN_MAINTENANCE_MODE\"'}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\");\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"      //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" If is in maintenance mode, point the url pathname to the maintenance page\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"      if\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" (\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"isInMaintenanceMode\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"        req\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"nextUrl\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"pathname \"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" `/maintenance`\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\";\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"        //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" Rewrite to the url\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"        return\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextResponse\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"rewrite\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"req\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"nextUrl\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\");\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"      }\"})}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    }\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" catch\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" (\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"error\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"      //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" show the default page if EDGE_CONFIG env var is missing,\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"      //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" but log the error to the console\"})]}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"      console\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"error\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF\"},children:\"error\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\");\"})]}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    }\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  }\"})}),`\n`,(0,n.jsxs)(e.span,{className:\"line\",children:[(0,n.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  //\"}),(0,n.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" #endregion maintenance mode\"})]})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"This code handles the maintenance mode exactly as what is provided in the Vercel\\u2019s example, but there are slight differences:\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"Try/catch block\"}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"process.env.NODE_ENV check\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"This defensive mechanism is important to handle any unexpected errors and that to apply the maintenance mode only in production.\"}),`\n`,(0,n.jsx)(e.h3,{id:\"about-me\",children:\"About me:\"}),`\n`,(0,n.jsx)(e.p,{children:\"Hey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I am open to work on interesting projects. Send me an email at \",(0,n.jsx)(e.a,{href:\"mailto:ramu.narasinga@gmail.com\",children:\"ramu.narasinga@gmail.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My Github\\u200A\\u2014\\u200A \",(0,n.jsx)(e.a,{href:\"https://github.com/ramu-narasinga\",children:\"https://github.com/ramu-narasinga\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My website\\u200A\\u2014\\u200A \",(0,n.jsx)(e.a,{href:\"https://ramunarasinga.com/\",children:\"https://ramunarasinga.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My Youtube channel\\u200A\\u2014\\u200A \",(0,n.jsx)(e.a,{href:\"https://www.youtube.com/@thinkthroo\",children:\"https://www.youtube.com/@thinkthroo\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Learning platform\\u200A\\u2014\\u200A \",(0,n.jsx)(e.a,{href:\"https://thinkthroo.com/\",children:\"https://thinkthroo.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Codebase Architecture\\u200A\\u2014\\u200A \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/architecture\",children:\"https://app.thinkthroo.com/architecture\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Best practices\\u200A\\u2014\\u200A \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/best-practices\",children:\"https://app.thinkthroo.com/best-practices\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Production-grade projects\\u200A\\u2014\\u200A \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/production-grade-projects\",children:\"https://app.thinkthroo.com/production-grade-projects\"})]}),`\n`,(0,n.jsx)(e.h3,{id:\"references\",children:\"References:\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14\",children:\"https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/discussions/12850\",children:\"https://github.com/vercel/next.js/discussions/12850\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://vercel.com/templates/next.js/maintenance-page\",children:\"https://vercel.com/templates/next.js/maintenance-page\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/discussions/12850#discussioncomment-3335807\",children:\"https://github.com/vercel/next.js/discussions/12850#discussioncomment-3335807\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14\",children:\"https://github.com/gridaco/grida/blob/main/apps/forms/middleware.ts#L14\"})}),`\n`]}),`\n`]})]})}function h(l={}){let{wrapper:e}=l.components||{};return e?(0,n.jsx)(e,{...l,children:(0,n.jsx)(F,{...l})}):F(l)}return N(x);})();\n;return Component;"
  },
  "_id": "blog/maintenance-mode-in-nextjs.mdx",
  "_raw": {
    "sourceFilePath": "blog/maintenance-mode-in-nextjs.mdx",
    "sourceFileName": "maintenance-mode-in-nextjs.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/maintenance-mode-in-nextjs"
  },
  "type": "Doc",
  "slug": "/blog/maintenance-mode-in-nextjs",
  "slugAsParams": "maintenance-mode-in-nextjs"
}