{
  "title": "How to override your Zustand state.\r",
  "published": false,
  "featured": false,
  "component": false,
  "toc": true,
  "body": {
    "raw": "\r\nIn this article, we’ll explore how [Zustand enables state replacement](https://github.com/pmndrs/zustand/blob/v4.5.5/tests/basic.test.tsx#L464C1-L474C3) with the `setState` function, focusing on an interesting feature: overriding the state without merging. We'll explain how to use it with a simple test case.\r\n\r\n![](https://miro.medium.com/v2/resize:fit:875/1*4y6ZBmrF_WwazzVdxECwPw.png)\r\n\r\n# **Understanding State Merging vs State Overriding**\r\n\r\nBefore looking at the code, it’s important to understand the difference between **merging** and **overriding** state.\r\n\r\n* **Merging State:** By default, when you update state in Zustand (or React), it merges the new state with the existing state. Only the updated fields are changed, while the rest of the state remains intact.\r\n    \r\n* **Overriding State:** In contrast, overriding the state **replaces** the entire state with a new object, discarding any fields that were present in the previous state but are not part of the new state.\r\n    \r\n\r\n# **When to Override State**\r\n\r\nThere are situations where replacing the entire state is necessary, for instance:\r\n\r\n* Resetting state after a form submission.\r\n    \r\n* Replacing state entirely when loading a different dataset.\r\n    \r\n\r\n# **Test Case for Overriding Zustand State**\r\n\r\nHere’s a simple test case from [Zustand’s codebase](https://github.com/pmndrs/zustand/blob/v4.5.5/tests/basic.test.tsx#L464C1-L474C3) that demonstrates how to override the state using the `setState` function:\r\n\r\n```plaintext\r\nit('can set the store without merging', () => {\r\n  const { setState, getState } = create<{ a: number } | { b: number }>(\r\n    (_set) => ({\r\n      a: 1,\r\n    }),\r\n  )\r\n\r\n  // Should override the state instead of merging.\r\n  setState({ b: 2 }, true)\r\n  expect(getState()).toEqual({ b: 2 })\r\n})\r\n```\r\n\r\n## **Breaking Down the Test**\r\n\r\n**1\\. Creating the Store** First, a Zustand store is created with an initial state:\r\n\r\n```plaintext\r\nconst { setState, getState } = create<{ a: number } | { b: number }>(\r\n    (_set) => ({\r\n      a: 1,\r\n    }),\r\n  )\r\n```\r\n\r\nThe initial state is an object with a single property `a` set to 1. The `create` function returns two essential methods:\r\n\r\n* `setState`**:** This method is used to update the store’s state.\r\n    \r\n* `getState`**:** This method retrieves the current state of the store.\r\n    \r\n\r\n**2\\. Overriding the State** The key operation here is to replace the current state, `{ a: 1 }`, with a completely new state:\r\n\r\n```plaintext\r\nsetState({ b: 2 }, true)\r\n```\r\n\r\n* By passing the `true` flag as the second argument, [Zustand knows that it should **override** the state](https://github.com/pmndrs/zustand/tree/v4.5.5?tab=readme-ov-file#overwriting-state), rather than merge the new object `{ b: 2 }` with the existing one. This completely replaces the previous state, so `{ a: 1 }` is removed, and the new state becomes `{ b: 2 }`.\r\n    \r\n\r\n**3\\. Validating the State Replacement** Finally, the test ensures that the state has been fully replaced:\r\n\r\n```plaintext\r\nexpect(getState()).toEqual({ b: 2 })\r\n```\r\n\r\nThe expectation is that after calling `setState({ b: 2 }, true)`, the store’s state will only contain `{ b: 2 }` and no longer contain `{ a: 1 }`.\r\n\r\n# **How Zustand Overrides State**\r\n\r\nThe below image is from Zustand source code that sets state.\r\n\r\n![](https://miro.medium.com/v2/resize:fit:875/1*24QbQNEbrCvDfS8Gt4zcCQ.png)\r\n\r\nAs you can see, if replace flag exists, nextState become the new state.\r\n\r\n```plaintext\r\n(replace ?? (typeof nextState !== 'object' || nextState === null))\r\n```\r\n\r\nThis is a clever way, if replace is false, which it is by default, `(typeof nextState !== ‘object’ || nextState === null))` condition is checked.\r\n\r\n# **Conclusion**\r\n\r\nZustand offers a straightforward way to manage state in React, and the ability to override the state completely using `setState` with the override flag provides additional flexibility. Whether you want to reset a form, load new data, or clear out old values, this feature allows you to fully control how state is managed and updated in your application.\r\n\r\n# **About me:**\r\n\r\nHey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\r\n\r\nI am open to work on interesting projects. Send me an email at ramu.narasinga@gmail.com\r\n\r\nMy Github — [https://github.com/ramu-narasinga](https://github.com/ramu-narasinga)\r\n\r\nMy website — [https://ramunarasinga.com](https://ramunarasinga.com/)\r\n\r\nMy Youtube channel — [https://www.youtube.com/@thinkthroo](https://www.youtube.com/@thinkthroo)\r\n\r\nLearning platform — [https://thinkthroo.com](https://thinkthroo.com/)\r\n\r\nCodebase Architecture — [https://app.thinkthroo.com/architecture](https://app.thinkthroo.com/architecture)\r\n\r\nBest practices — [https://app.thinkthroo.com/best-practices](https://app.thinkthroo.com/best-practices)\r\n\r\nProduction-grade projects — [https://app.thinkthroo.com/production-grade-projects](https://app.thinkthroo.com/production-grade-projects)\r\n\r\n# **References:**\r\n\r\n1. [https://github.com/pmndrs/zustand/blob/v4.5.5/tests/basic.test.tsx#L471C13-L471C50](https://github.com/pmndrs/zustand/blob/v4.5.5/tests/basic.test.tsx#L471C13-L471C50)\r\n    \r\n2. [https://github.com/pmndrs/zustand/tree/v4.5.5?tab=readme-ov-file#overwriting-state](https://github.com/pmndrs/zustand/tree/v4.5.5?tab=readme-ov-file#overwriting-state)\r\n",
    "code": "var Component=(()=>{var p=Object.create;var i=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var b=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),w=(n,e)=>{for(var a in e)i(n,a,{get:e[a],enumerable:!0})},d=(n,e,a,s)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of g(e))!f.call(n,r)&&r!==a&&i(n,r,{get:()=>e[r],enumerable:!(s=u(e,r))||s.enumerable});return n};var v=(n,e,a)=>(a=n!=null?p(m(n)):{},d(e||!n||!n.__esModule?i(a,\"default\",{value:n,enumerable:!0}):a,n)),y=n=>d(i({},\"__esModule\",{value:!0}),n);var c=b((k,h)=>{h.exports=_jsx_runtime});var S={};w(S,{default:()=>o,frontmatter:()=>x});var t=v(c()),x={title:\"How to override your Zustand state.\"};function l(n){let e={a:\"a\",code:\"code\",div:\"div\",h1:\"h1\",h2:\"h2\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:[\"In this article, we\\u2019ll explore how \",(0,t.jsx)(e.a,{href:\"https://github.com/pmndrs/zustand/blob/v4.5.5/tests/basic.test.tsx#L464C1-L474C3\",children:\"Zustand enables state replacement\"}),\" with the \",(0,t.jsx)(e.code,{children:\"setState\"}),\" function, focusing on an interesting feature: overriding the state without merging. We'll explain how to use it with a simple test case.\"]}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:\"https://miro.medium.com/v2/resize:fit:875/1*4y6ZBmrF_WwazzVdxECwPw.png\",alt:\"\"})}),`\n`,(0,t.jsx)(e.h1,{id:\"understanding-state-merging-vs-state-overriding\",children:(0,t.jsx)(e.strong,{children:\"Understanding State Merging vs State Overriding\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"Before looking at the code, it\\u2019s important to understand the difference between \",(0,t.jsx)(e.strong,{children:\"merging\"}),\" and \",(0,t.jsx)(e.strong,{children:\"overriding\"}),\" state.\"]}),`\n`,(0,t.jsxs)(e.ul,{children:[`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:\"Merging State:\"}),\" By default, when you update state in Zustand (or React), it merges the new state with the existing state. Only the updated fields are changed, while the rest of the state remains intact.\"]}),`\n`]}),`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:\"Overriding State:\"}),\" In contrast, overriding the state \",(0,t.jsx)(e.strong,{children:\"replaces\"}),\" the entire state with a new object, discarding any fields that were present in the previous state but are not part of the new state.\"]}),`\n`]}),`\n`]}),`\n`,(0,t.jsx)(e.h1,{id:\"when-to-override-state\",children:(0,t.jsx)(e.strong,{children:\"When to Override State\"})}),`\n`,(0,t.jsx)(e.p,{children:\"There are situations where replacing the entire state is necessary, for instance:\"}),`\n`,(0,t.jsxs)(e.ul,{children:[`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsx)(e.p,{children:\"Resetting state after a form submission.\"}),`\n`]}),`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsx)(e.p,{children:\"Replacing state entirely when loading a different dataset.\"}),`\n`]}),`\n`]}),`\n`,(0,t.jsx)(e.h1,{id:\"test-case-for-overriding-zustand-state\",children:(0,t.jsx)(e.strong,{children:\"Test Case for Overriding Zustand State\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"Here\\u2019s a simple test case from \",(0,t.jsx)(e.a,{href:\"https://github.com/pmndrs/zustand/blob/v4.5.5/tests/basic.test.tsx#L464C1-L474C3\",children:\"Zustand\\u2019s codebase\"}),\" that demonstrates how to override the state using the \",(0,t.jsx)(e.code,{children:\"setState\"}),\" function:\"]}),`\n`,(0,t.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,t.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,t.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"it('can set the store without merging', () => {\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"  const { setState, getState } = create<{ a: number } | { b: number }>(\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"    (_set) => ({\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"      a: 1,\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"    }),\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"  )\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"  // Should override the state instead of merging.\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"  setState({ b: 2 }, true)\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"  expect(getState()).toEqual({ b: 2 })\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"})\"})})]})})}),`\n`,(0,t.jsx)(e.h2,{id:\"breaking-down-the-test\",children:(0,t.jsx)(e.strong,{children:\"Breaking Down the Test\"})}),`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:\"1. Creating the Store\"}),\" First, a Zustand store is created with an initial state:\"]}),`\n`,(0,t.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,t.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,t.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"const { setState, getState } = create<{ a: number } | { b: number }>(\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"    (_set) => ({\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"      a: 1,\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"    }),\"})}),`\n`,(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"  )\"})})]})})}),`\n`,(0,t.jsxs)(e.p,{children:[\"The initial state is an object with a single property \",(0,t.jsx)(e.code,{children:\"a\"}),\" set to 1. The \",(0,t.jsx)(e.code,{children:\"create\"}),\" function returns two essential methods:\"]}),`\n`,(0,t.jsxs)(e.ul,{children:[`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:\"setState\"}),(0,t.jsx)(e.strong,{children:\":\"}),\" This method is used to update the store\\u2019s state.\"]}),`\n`]}),`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:\"getState\"}),(0,t.jsx)(e.strong,{children:\":\"}),\" This method retrieves the current state of the store.\"]}),`\n`]}),`\n`]}),`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:\"2. Overriding the State\"}),\" The key operation here is to replace the current state, \",(0,t.jsx)(e.code,{children:\"{ a: 1 }\"}),\", with a completely new state:\"]}),`\n`,(0,t.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,t.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,t.jsx)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"setState({ b: 2 }, true)\"})})})})}),`\n`,(0,t.jsxs)(e.ul,{children:[`\n`,(0,t.jsxs)(e.li,{children:[\"By passing the \",(0,t.jsx)(e.code,{children:\"true\"}),\" flag as the second argument, \",(0,t.jsxs)(e.a,{href:\"https://github.com/pmndrs/zustand/tree/v4.5.5?tab=readme-ov-file#overwriting-state\",children:[\"Zustand knows that it should \",(0,t.jsx)(e.strong,{children:\"override\"}),\" the state\"]}),\", rather than merge the new object \",(0,t.jsx)(e.code,{children:\"{ b: 2 }\"}),\" with the existing one. This completely replaces the previous state, so \",(0,t.jsx)(e.code,{children:\"{ a: 1 }\"}),\" is removed, and the new state becomes \",(0,t.jsx)(e.code,{children:\"{ b: 2 }\"}),\".\"]}),`\n`]}),`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:\"3. Validating the State Replacement\"}),\" Finally, the test ensures that the state has been fully replaced:\"]}),`\n`,(0,t.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,t.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,t.jsx)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"expect(getState()).toEqual({ b: 2 })\"})})})})}),`\n`,(0,t.jsxs)(e.p,{children:[\"The expectation is that after calling \",(0,t.jsx)(e.code,{children:\"setState({ b: 2 }, true)\"}),\", the store\\u2019s state will only contain \",(0,t.jsx)(e.code,{children:\"{ b: 2 }\"}),\" and no longer contain \",(0,t.jsx)(e.code,{children:\"{ a: 1 }\"}),\".\"]}),`\n`,(0,t.jsx)(e.h1,{id:\"how-zustand-overrides-state\",children:(0,t.jsx)(e.strong,{children:\"How Zustand Overrides State\"})}),`\n`,(0,t.jsx)(e.p,{children:\"The below image is from Zustand source code that sets state.\"}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:\"https://miro.medium.com/v2/resize:fit:875/1*24QbQNEbrCvDfS8Gt4zcCQ.png\",alt:\"\"})}),`\n`,(0,t.jsx)(e.p,{children:\"As you can see, if replace flag exists, nextState become the new state.\"}),`\n`,(0,t.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,t.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,t.jsx)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,t.jsx)(e.span,{className:\"line\",children:(0,t.jsx)(e.span,{children:\"(replace ?? (typeof nextState !== 'object' || nextState === null))\"})})})})}),`\n`,(0,t.jsxs)(e.p,{children:[\"This is a clever way, if replace is false, which it is by default, \",(0,t.jsx)(e.code,{children:\"(typeof nextState !== \\u2018object\\u2019 || nextState === null))\"}),\" condition is checked.\"]}),`\n`,(0,t.jsx)(e.h1,{id:\"conclusion\",children:(0,t.jsx)(e.strong,{children:\"Conclusion\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"Zustand offers a straightforward way to manage state in React, and the ability to override the state completely using \",(0,t.jsx)(e.code,{children:\"setState\"}),\" with the override flag provides additional flexibility. Whether you want to reset a form, load new data, or clear out old values, this feature allows you to fully control how state is managed and updated in your application.\"]}),`\n`,(0,t.jsx)(e.h1,{id:\"about-me\",children:(0,t.jsx)(e.strong,{children:\"About me:\"})}),`\n`,(0,t.jsx)(e.p,{children:\"Hey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"I am open to work on interesting projects. Send me an email at \",(0,t.jsx)(e.a,{href:\"mailto:ramu.narasinga@gmail.com\",children:\"ramu.narasinga@gmail.com\"})]}),`\n`,(0,t.jsxs)(e.p,{children:[\"My Github \\u2014 \",(0,t.jsx)(e.a,{href:\"https://github.com/ramu-narasinga\",children:\"https://github.com/ramu-narasinga\"})]}),`\n`,(0,t.jsxs)(e.p,{children:[\"My website \\u2014 \",(0,t.jsx)(e.a,{href:\"https://ramunarasinga.com/\",children:\"https://ramunarasinga.com\"})]}),`\n`,(0,t.jsxs)(e.p,{children:[\"My Youtube channel \\u2014 \",(0,t.jsx)(e.a,{href:\"https://www.youtube.com/@thinkthroo\",children:\"https://www.youtube.com/@thinkthroo\"})]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Learning platform \\u2014 \",(0,t.jsx)(e.a,{href:\"https://thinkthroo.com/\",children:\"https://thinkthroo.com\"})]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Codebase Architecture \\u2014 \",(0,t.jsx)(e.a,{href:\"https://app.thinkthroo.com/architecture\",children:\"https://app.thinkthroo.com/architecture\"})]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Best practices \\u2014 \",(0,t.jsx)(e.a,{href:\"https://app.thinkthroo.com/best-practices\",children:\"https://app.thinkthroo.com/best-practices\"})]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Production-grade projects \\u2014 \",(0,t.jsx)(e.a,{href:\"https://app.thinkthroo.com/production-grade-projects\",children:\"https://app.thinkthroo.com/production-grade-projects\"})]}),`\n`,(0,t.jsx)(e.h1,{id:\"references\",children:(0,t.jsx)(e.strong,{children:\"References:\"})}),`\n`,(0,t.jsxs)(e.ol,{children:[`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.a,{href:\"https://github.com/pmndrs/zustand/blob/v4.5.5/tests/basic.test.tsx#L471C13-L471C50\",children:\"https://github.com/pmndrs/zustand/blob/v4.5.5/tests/basic.test.tsx#L471C13-L471C50\"})}),`\n`]}),`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.a,{href:\"https://github.com/pmndrs/zustand/tree/v4.5.5?tab=readme-ov-file#overwriting-state\",children:\"https://github.com/pmndrs/zustand/tree/v4.5.5?tab=readme-ov-file#overwriting-state\"})}),`\n`]}),`\n`]})]})}function o(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(l,{...n})}):l(n)}return y(S);})();\n;return Component;"
  },
  "_id": "blog/how-to-override-zustand.mdx",
  "_raw": {
    "sourceFilePath": "blog/how-to-override-zustand.mdx",
    "sourceFileName": "how-to-override-zustand.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/how-to-override-zustand"
  },
  "type": "Doc",
  "slug": "/blog/how-to-override-zustand",
  "slugAsParams": "how-to-override-zustand"
}