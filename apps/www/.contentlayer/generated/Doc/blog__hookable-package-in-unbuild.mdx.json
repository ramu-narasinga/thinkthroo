{
  "title": "Hookable package in unbuild source code.\r",
  "published": false,
  "featured": false,
  "component": false,
  "toc": true,
  "body": {
    "raw": "\r\nFor this week, I have been reading [unbuild](https://github.com/unjs/unbuild) source code and found few packages that I have never seen before or used. I wanted to share some interesting packages that are used in these OSS projects so we can learn a thing or two ;)\r\n\r\nThe following are discussed in this article:\r\n\r\n1. What is hookable?\r\n    \r\n2. Hookable’s usage in unbuild\r\n    \r\n\r\n### What is hookable?\r\n\r\nHookable is a package built by [authors at Unjs](https://github.com/unjs). Unjs provides JS tools, libraries and has about 63 npm packages and [421m downloads per month](https://unjs.io/packages?q=&order=1&orderBy=title). Sheesh, that’s a lot.\r\n\r\n![](https://cdn-images-1.medium.com/max/1600/1*d8woH8hDsiZShDCV5fPm6g.png align=\"left\")\r\n\r\n[Hookable repository](https://github.com/unjs/hookable) has this description “Awaitable Hooks”.\r\n\r\nThis package is straightforward to use:\r\n\r\n#### Install\r\n\r\n```plaintext\r\nnpm install hookable\r\n```\r\n\r\n#### Usage\r\n\r\n```plaintext\r\n// Method A:\r\nimport { createHooks } from 'hookable'\r\n\r\n// Create a hookable instance\r\nconst hooks = createHooks()\r\n\r\n// Hook on 'hello'\r\nhooks.hook('hello', () => { console.log('Hello World' )})\r\n\r\n// Call 'hello' hook\r\nhooks.callHook('hello')\r\n```\r\n\r\nBasically, you create a hook with a callback and call these hooks somewhere else in your codebase to trigger this callback. Let’s what sort of hooks are found in unbuild source code.\r\n\r\n### Hookable’s usage in unbuild\r\n\r\n#### Initializing hookable\r\n\r\n[At line 182 in build.ts](https://github.com/unjs/unbuild/blob/main/src/build.ts#L182), you will find the below code:\r\n\r\n```plaintext\r\n// Build context\r\n  const ctx: BuildContext = {\r\n    options,\r\n    jiti,\r\n    warnings: new Set(),\r\n    pkg,\r\n    buildEntries: [],\r\n    usedImports: new Set(),\r\n    hooks: createHooks(),\r\n  };\r\n```\r\n\r\n#### Register hooks\r\n\r\n[At the line 185 in build.ts](https://github.com/unjs/unbuild/blob/main/src/build.ts#L185), you will find the below code:\r\n\r\n```plaintext\r\n// Register hooks\r\n  if (preset.hooks) {\r\n    ctx.hooks.addHooks(preset.hooks);\r\n  }\r\n  if (inputConfig.hooks) {\r\n    ctx.hooks.addHooks(inputConfig.hooks);\r\n  }\r\n  if (buildConfig.hooks) {\r\n    ctx.hooks.addHooks(buildConfig.hooks);\r\n  }\r\n```\r\n\r\n#### Calling the hooks\r\n\r\nI[n build.ts](https://github.com/unjs/unbuild/blob/main/src/build.ts#L197), you will find the below code used to call registered hooks:\r\n\r\n```plaintext\r\n// Allow prepare and extending context\r\nawait ctx.hooks.callHook(\"build:prepare\", ctx);\r\n// Call build:before\r\nawait ctx.hooks.callHook(\"build:before\", ctx);\r\n// Skip rest for stub and watch mode\r\nif (options.stub || options.watch) {\r\n  await ctx.hooks.callHook(\"build:done\", ctx);\r\n  return;\r\n}\r\n// Call build:done\r\nawait ctx.hooks.callHook(\"build:done\", ctx);\r\n```\r\n\r\n### About me:\r\n\r\nHey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\r\n\r\n***I am open to work on interesting projects. Send me an email at ramu.narasinga@gmail.com***\r\n\r\nMy Github — [https://github.com/ramu-narasinga](https://github.com/ramu-narasinga)\r\n\r\nMy website — [https://ramunarasinga.com](https://ramunarasinga.com/)\r\n\r\nMy Youtube channel — [https://www.youtube.com/@thinkthroo](https://www.youtube.com/@thinkthroo)\r\n\r\nLearning platform — [https://thinkthroo.com](https://thinkthroo.com/)\r\n\r\nCodebase Architecture — [https://app.thinkthroo.com/architecture](https://app.thinkthroo.com/architecture)\r\n\r\nBest practices — [https://app.thinkthroo.com/best-practices](https://app.thinkthroo.com/best-practices)\r\n\r\nProduction-grade projects — [https://app.thinkthroo.com/production-grade-projects](https://app.thinkthroo.com/production-grade-projects)\r\n\r\n### References\r\n\r\n1. [https://github.com/unjs/unbuild/blob/main/src/build.ts#L182](https://github.com/unjs/unbuild/blob/main/src/build.ts#L182)\r\n    \r\n2. [https://github.com/unjs/unbuild/blob/main/src/build.ts#L193](https://github.com/unjs/unbuild/blob/main/src/build.ts#L193)\r\n    \r\n3. [https://github.com/unjs/unbuild/blob/main/src/build.ts#L197](https://github.com/unjs/unbuild/blob/main/src/build.ts#L197)\r\n    \r\n4. [https://www.npmjs.com/package/hookable](https://www.npmjs.com/package/hookable)[https://github.com/unjs/unbuild/blob/main/src/build.ts#L93](https://github.com/unjs/unbuild/blob/main/src/build.ts#L93)",
    "code": "var Component=(()=>{var p=Object.create;var s=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var k=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports),f=(a,n)=>{for(var i in n)s(a,i,{get:n[i],enumerable:!0})},h=(a,n,i,t)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let l of m(n))!g.call(a,l)&&l!==i&&s(a,l,{get:()=>n[l],enumerable:!(t=u(n,l))||t.enumerable});return a};var w=(a,n,i)=>(i=a!=null?p(b(a)):{},h(n||!a||!a.__esModule?s(i,\"default\",{value:a,enumerable:!0}):i,a)),N=a=>h(s({},\"__esModule\",{value:!0}),a);var r=k((H,c)=>{c.exports=_jsx_runtime});var j={};f(j,{default:()=>o,frontmatter:()=>x});var e=w(r()),x={title:\"Hookable package in unbuild source\\xA0code.\"};function d(a){let n={a:\"a\",code:\"code\",div:\"div\",em:\"em\",h3:\"h3\",h4:\"h4\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...a.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"For this week, I have been reading \",(0,e.jsx)(n.a,{href:\"https://github.com/unjs/unbuild\",children:\"unbuild\"}),\" source code and found few packages that I have never seen before or used. I wanted to share some interesting packages that are used in these OSS projects so we can learn a thing or two\\xA0;)\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The following are discussed in this article:\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:\"What is hookable?\"}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:\"Hookable\\u2019s usage in unbuild\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(n.h3,{id:\"what-is-hookable\",children:\"What is hookable?\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"Hookable is a package built by \",(0,e.jsx)(n.a,{href:\"https://github.com/unjs\",children:\"authors at Unjs\"}),\". Unjs provides JS tools, libraries and has about 63 npm packages and \",(0,e.jsx)(n.a,{href:\"https://unjs.io/packages?q=&order=1&orderBy=title\",children:\"421m downloads per month\"}),\". Sheesh, that\\u2019s a lot.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"![](\",(0,e.jsx)(n.a,{href:\"https://cdn-images-1.medium.com/max/1600/1*d8woH8hDsiZShDCV5fPm6g.png\",children:\"https://cdn-images-1.medium.com/max/1600/1*d8woH8hDsiZShDCV5fPm6g.png\"}),' align=\"left\")']}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://github.com/unjs/hookable\",children:\"Hookable repository\"}),\" has this description \\u201CAwaitable Hooks\\u201D.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"This package is straightforward to use:\"}),`\n`,(0,e.jsx)(n.h4,{id:\"install\",children:\"Install\"}),`\n`,(0,e.jsx)(n.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(n.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,e.jsx)(n.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"npm install hookable\"})})})})}),`\n`,(0,e.jsx)(n.h4,{id:\"usage\",children:\"Usage\"}),`\n`,(0,e.jsx)(n.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(n.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,e.jsxs)(n.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"// Method A:\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"import { createHooks } from 'hookable'\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"// Create a hookable instance\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"const hooks = createHooks()\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"// Hook on 'hello'\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"hooks.hook('hello', () => { console.log('Hello World' )})\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"// Call 'hello' hook\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"hooks.callHook('hello')\"})})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"Basically, you create a hook with a callback and call these hooks somewhere else in your codebase to trigger this callback. Let\\u2019s what sort of hooks are found in unbuild source code.\"}),`\n`,(0,e.jsx)(n.h3,{id:\"hookables-usage-inunbuild\",children:\"Hookable\\u2019s usage in\\xA0unbuild\"}),`\n`,(0,e.jsx)(n.h4,{id:\"initializing-hookable\",children:\"Initializing hookable\"}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L182\",children:\"At line 182 in build.ts\"}),\", you will find the below code:\"]}),`\n`,(0,e.jsx)(n.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(n.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,e.jsxs)(n.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"// Build context\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"  const ctx: BuildContext = {\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"    options,\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"    jiti,\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"    warnings: new Set(),\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"    pkg,\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"    buildEntries: [],\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"    usedImports: new Set(),\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"    hooks: createHooks(),\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"  };\"})})]})})}),`\n`,(0,e.jsx)(n.h4,{id:\"register-hooks\",children:\"Register hooks\"}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L185\",children:\"At the line 185 in build.ts\"}),\", you will find the below code:\"]}),`\n`,(0,e.jsx)(n.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(n.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,e.jsxs)(n.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"// Register hooks\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"  if (preset.hooks) {\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"    ctx.hooks.addHooks(preset.hooks);\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"  }\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"  if (inputConfig.hooks) {\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"    ctx.hooks.addHooks(inputConfig.hooks);\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"  }\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"  if (buildConfig.hooks) {\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"    ctx.hooks.addHooks(buildConfig.hooks);\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"  }\"})})]})})}),`\n`,(0,e.jsx)(n.h4,{id:\"calling-thehooks\",children:\"Calling the\\xA0hooks\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"I\",(0,e.jsx)(n.a,{href:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L197\",children:\"n build.ts\"}),\", you will find the below code used to call registered hooks:\"]}),`\n`,(0,e.jsx)(n.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,e.jsx)(n.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,e.jsxs)(n.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"// Allow prepare and extending context\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:'await ctx.hooks.callHook(\"build:prepare\", ctx);'})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"// Call build:before\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:'await ctx.hooks.callHook(\"build:before\", ctx);'})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"// Skip rest for stub and watch mode\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"if (options.stub || options.watch) {\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:'  await ctx.hooks.callHook(\"build:done\", ctx);'})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"  return;\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"}\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:\"// Call build:done\"})}),`\n`,(0,e.jsx)(n.span,{className:\"line\",children:(0,e.jsx)(n.span,{children:'await ctx.hooks.callHook(\"build:done\", ctx);'})})]})})}),`\n`,(0,e.jsx)(n.h3,{id:\"about-me\",children:\"About me:\"}),`\n`,(0,e.jsx)(n.p,{children:\"Hey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsxs)(n.strong,{children:[\"I am open to work on interesting projects. Send me an email at \",(0,e.jsx)(n.a,{href:\"mailto:ramu.narasinga@gmail.com\",children:\"ramu.narasinga@gmail.com\"})]})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"My Github\\u200A\\u2014\\u200A\",(0,e.jsx)(n.a,{href:\"https://github.com/ramu-narasinga\",children:\"https://github.com/ramu-narasinga\"})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"My website\\u200A\\u2014\\u200A\",(0,e.jsx)(n.a,{href:\"https://ramunarasinga.com/\",children:\"https://ramunarasinga.com\"})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"My Youtube channel\\u200A\\u2014\\u200A\",(0,e.jsx)(n.a,{href:\"https://www.youtube.com/@thinkthroo\",children:\"https://www.youtube.com/@thinkthroo\"})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Learning platform\\u200A\\u2014\\u200A\",(0,e.jsx)(n.a,{href:\"https://thinkthroo.com/\",children:\"https://thinkthroo.com\"})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Codebase Architecture\\u200A\\u2014\\u200A\",(0,e.jsx)(n.a,{href:\"https://app.thinkthroo.com/architecture\",children:\"https://app.thinkthroo.com/architecture\"})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Best practices\\u200A\\u2014\\u200A\",(0,e.jsx)(n.a,{href:\"https://app.thinkthroo.com/best-practices\",children:\"https://app.thinkthroo.com/best-practices\"})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Production-grade projects\\u200A\\u2014\\u200A\",(0,e.jsx)(n.a,{href:\"https://app.thinkthroo.com/production-grade-projects\",children:\"https://app.thinkthroo.com/production-grade-projects\"})]}),`\n`,(0,e.jsx)(n.h3,{id:\"references\",children:\"References\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L182\",children:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L182\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L193\",children:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L193\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L197\",children:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L197\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://www.npmjs.com/package/hookable\",children:\"https://www.npmjs.com/package/hookable\"}),(0,e.jsx)(n.a,{href:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L93\",children:\"https://github.com/unjs/unbuild/blob/main/src/build.ts#L93\"})]}),`\n`]}),`\n`]})]})}function o(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,{...a,children:(0,e.jsx)(d,{...a})}):d(a)}return N(j);})();\n;return Component;"
  },
  "_id": "blog/hookable-package-in-unbuild.mdx",
  "_raw": {
    "sourceFilePath": "blog/hookable-package-in-unbuild.mdx",
    "sourceFileName": "hookable-package-in-unbuild.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/hookable-package-in-unbuild"
  },
  "type": "Doc",
  "slug": "/blog/hookable-package-in-unbuild",
  "slugAsParams": "hookable-package-in-unbuild"
}