{
  "title": "useSyncExternalStoreExports in Zustand source code explained.\r",
  "published": false,
  "featured": false,
  "component": false,
  "toc": true,
  "body": {
    "raw": "\r\nIn this article, we will look at how Zustand uses `useSyncExternalStoreExports` in its [source code.](https://github.com/pmndrs/zustand/blob/main/src/traditional.ts#L44)\r\n\r\n![](https://miro.medium.com/v2/resize:fit:875/1*clGskdPnb_vycCWlYYcq5A.png)\r\n\r\n`useSyncExternalStoreExports` is imported from [use-sync-external-store/shim/with-selector](https://www.npmjs.com/package/use-sync-external-store). use-sync-external-store is a backwards-compatible shim for [`React.useSyncExternalStore`](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore) Works with any React that supports Hooks.\r\n\r\nReading the above sentence, you might be wondering what a useSyncExternalStore.\r\n\r\n# **useSyncExternalStore**\r\n\r\n[`useSyncExternalStore`](https://react.dev/reference/react/useSyncExternalStore) is a React Hook that lets you subscribe to an external store.\r\n\r\n```plaintext\r\nconst snapshot = useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot?)\r\n```\r\n\r\nUse the useSyncExternalStore to read a value from external store that can be:\r\n\r\n1. Third-party state management libraries that hold state outside of React.\r\n    \r\n2. Browser APIs that expose a mutable value and events to subscribe to its changes.\r\n    \r\n\r\n## **Example usage:**\r\n\r\n```plaintext\r\nimport { useSyncExternalStore } from 'react';\r\nimport { todosStore } from './todoStore.js';\r\n\r\nfunction TodosApp() {\r\n  const todos = useSyncExternalStore(todosStore.subscribe, todosStore.getSnapshot);\r\n  // ...\r\n}\r\n```\r\n\r\nThe above example is picked from [React docs](https://react.dev/reference/react/useSyncExternalStore#subscribing-to-an-external-store).\r\n\r\n# **useSyncExternalStore Usage In Zustand:**\r\n\r\nZustand uses `useSyncExternalStore` in [src/traditional.ts](https://github.com/pmndrs/zustand/blob/main/src/traditional.ts#L44).\r\n\r\n```plaintext\r\nimport ReactExports from 'react'\r\n// eslint-disable-next-line import/extensions\r\nimport useSyncExternalStoreExports from 'use-sync-external-store/shim/with-selector'\r\nimport { createStore } from './vanilla.ts'\r\nimport type {\r\n  Mutate,\r\n  StateCreator,\r\n  StoreApi,\r\n  StoreMutatorIdentifier,\r\n} from './vanilla.ts'\r\n\r\nconst { useDebugValue } = ReactExports\r\nconst { useSyncExternalStoreWithSelector } = useSyncExternalStoreExports\r\n```\r\n\r\n`useSyncExternalStoreWithSelector` is de-structured from `useSyncExternalStoreExports` and this is used in `useStoreWithEqualityFn`.\r\n\r\n```plaintext\r\nexport function useStoreWithEqualityFn<TState, StateSlice>(\r\n  api: ReadonlyStoreApi<TState>,\r\n  selector: (state: TState) => StateSlice = identity as any,\r\n  equalityFn?: (a: StateSlice, b: StateSlice) => boolean,\r\n) {\r\n  const slice = useSyncExternalStoreWithSelector(\r\n    api.subscribe,\r\n    api.getState,\r\n    api.getInitialState,\r\n    selector,\r\n    equalityFn,\r\n  )\r\n  useDebugValue(slice)\r\n  return slice\r\n}\r\n```\r\n\r\nuseSyncExternalStoreWithSelector has api.subscribe, api.getState, api.getInitialState, selector and equalityFn.\r\n\r\n# **About me:**\r\n\r\nHey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\r\n\r\nI am open to work on interesting projects. Send me an email at ramu.narasinga@gmail.com\r\n\r\nMy Github — [https://github.com/ramu-narasinga](https://github.com/ramu-narasinga)\r\n\r\nMy website — [https://ramunarasinga.com](https://ramunarasinga.com/)\r\n\r\nMy Youtube channel — [https://www.youtube.com/@thinkthroo](https://www.youtube.com/@thinkthroo)\r\n\r\nLearning platform — [https://thinkthroo.com](https://thinkthroo.com/)\r\n\r\nCodebase Architecture — [https://app.thinkthroo.com/architecture](https://app.thinkthroo.com/architecture)\r\n\r\nBest practices — [https://app.thinkthroo.com/best-practices](https://app.thinkthroo.com/best-practices)\r\n\r\nProduction-grade projects — [https://app.thinkthroo.com/production-grade-projects](https://app.thinkthroo.com/production-grade-projects)\r\n\r\n# **References:**\r\n\r\n1. [https://github.com/pmndrs/zustand/blob/main/src/traditional.ts#L44](https://github.com/pmndrs/zustand/blob/main/src/traditional.ts#L44)\r\n    \r\n2. [https://www.npmjs.com/package/use-sync-external-store](https://www.npmjs.com/package/use-sync-external-store)\r\n    \r\n3. [https://legacy.reactjs.org/docs/hooks-reference.html#usesyncexternalstore](https://legacy.reactjs.org/docs/hooks-reference.html#usesyncexternalstore)\r\n    \r\n4. [https://react.dev/reference/react/useSyncExternalStore](https://react.dev/reference/react/useSyncExternalStore)\r\n    \r\n5. [https://github.com/reactwg/react-18/discussions/86](https://github.com/reactwg/react-18/discussions/86)\r\n    \r\n\r\n[  \r\n](https://medium.com/tag/javascript?source=post_page-----5b92cc0f3bf8---------------javascript-----------------)\r\n",
    "code": "var Component=(()=>{var p=Object.create;var s=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var x=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),y=(t,e)=>{for(var a in e)s(t,a,{get:e[a],enumerable:!0})},i=(t,e,a,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of u(e))!S.call(t,r)&&r!==a&&s(t,r,{get:()=>e[r],enumerable:!(c=m(e,r))||c.enumerable});return t};var f=(t,e,a)=>(a=t!=null?p(g(t)):{},i(e||!t||!t.__esModule?s(a,\"default\",{value:t,enumerable:!0}):a,t)),b=t=>i(s({},\"__esModule\",{value:!0}),t);var h=x((k,l)=>{l.exports=_jsx_runtime});var E={};y(E,{default:()=>d,frontmatter:()=>N});var n=f(h()),N={title:\"useSyncExternalStoreExports in Zustand source code explained.\"};function o(t){let e={a:\"a\",br:\"br\",code:\"code\",div:\"div\",h1:\"h1\",h2:\"h2\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...t.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"In this article, we will look at how Zustand uses \",(0,n.jsx)(e.code,{children:\"useSyncExternalStoreExports\"}),\" in its \",(0,n.jsx)(e.a,{href:\"https://github.com/pmndrs/zustand/blob/main/src/traditional.ts#L44\",children:\"source code.\"})]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://miro.medium.com/v2/resize:fit:875/1*clGskdPnb_vycCWlYYcq5A.png\",alt:\"\"})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"useSyncExternalStoreExports\"}),\" is imported from \",(0,n.jsx)(e.a,{href:\"https://www.npmjs.com/package/use-sync-external-store\",children:\"use-sync-external-store/shim/with-selector\"}),\". use-sync-external-store is a backwards-compatible shim for \",(0,n.jsx)(e.a,{href:\"https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore\",children:(0,n.jsx)(e.code,{children:\"React.useSyncExternalStore\"})}),\" Works with any React that supports Hooks.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Reading the above sentence, you might be wondering what a useSyncExternalStore.\"}),`\n`,(0,n.jsx)(e.h1,{id:\"usesyncexternalstore\",children:(0,n.jsx)(e.strong,{children:\"useSyncExternalStore\"})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://react.dev/reference/react/useSyncExternalStore\",children:(0,n.jsx)(e.code,{children:\"useSyncExternalStore\"})}),\" is a React Hook that lets you subscribe to an external store.\"]}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsx)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"const snapshot = useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot?)\"})})})})}),`\n`,(0,n.jsx)(e.p,{children:\"Use the useSyncExternalStore to read a value from external store that can be:\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"Third-party state management libraries that hold state outside of React.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"Browser APIs that expose a mutable value and events to subscribe to its changes.\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{id:\"example-usage\",children:(0,n.jsx)(e.strong,{children:\"Example usage:\"})}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"import { useSyncExternalStore } from 'react';\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"import { todosStore } from './todoStore.js';\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"function TodosApp() {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  const todos = useSyncExternalStore(todosStore.subscribe, todosStore.getSnapshot);\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  // ...\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"}\"})})]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The above example is picked from \",(0,n.jsx)(e.a,{href:\"https://react.dev/reference/react/useSyncExternalStore#subscribing-to-an-external-store\",children:\"React docs\"}),\".\"]}),`\n`,(0,n.jsx)(e.h1,{id:\"usesyncexternalstore-usage-in-zustand\",children:(0,n.jsx)(e.strong,{children:\"useSyncExternalStore Usage In Zustand:\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Zustand uses \",(0,n.jsx)(e.code,{children:\"useSyncExternalStore\"}),\" in \",(0,n.jsx)(e.a,{href:\"https://github.com/pmndrs/zustand/blob/main/src/traditional.ts#L44\",children:\"src/traditional.ts\"}),\".\"]}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"import ReactExports from 'react'\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"// eslint-disable-next-line import/extensions\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"import useSyncExternalStoreExports from 'use-sync-external-store/shim/with-selector'\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"import { createStore } from './vanilla.ts'\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"import type {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  Mutate,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  StateCreator,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  StoreApi,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  StoreMutatorIdentifier,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"} from './vanilla.ts'\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"const { useDebugValue } = ReactExports\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"const { useSyncExternalStoreWithSelector } = useSyncExternalStoreExports\"})})]})})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"useSyncExternalStoreWithSelector\"}),\" is de-structured from \",(0,n.jsx)(e.code,{children:\"useSyncExternalStoreExports\"}),\" and this is used in \",(0,n.jsx)(e.code,{children:\"useStoreWithEqualityFn\"}),\".\"]}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"export function useStoreWithEqualityFn<TState, StateSlice>(\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  api: ReadonlyStoreApi<TState>,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  selector: (state: TState) => StateSlice = identity as any,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  equalityFn?: (a: StateSlice, b: StateSlice) => boolean,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\") {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  const slice = useSyncExternalStoreWithSelector(\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"    api.subscribe,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"    api.getState,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"    api.getInitialState,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"    selector,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"    equalityFn,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  )\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  useDebugValue(slice)\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  return slice\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"}\"})})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"useSyncExternalStoreWithSelector has api.subscribe, api.getState, api.getInitialState, selector and equalityFn.\"}),`\n`,(0,n.jsx)(e.h1,{id:\"about-me\",children:(0,n.jsx)(e.strong,{children:\"About me:\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Hey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I am open to work on interesting projects. Send me an email at \",(0,n.jsx)(e.a,{href:\"mailto:ramu.narasinga@gmail.com\",children:\"ramu.narasinga@gmail.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My Github \\u2014 \",(0,n.jsx)(e.a,{href:\"https://github.com/ramu-narasinga\",children:\"https://github.com/ramu-narasinga\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My website \\u2014 \",(0,n.jsx)(e.a,{href:\"https://ramunarasinga.com/\",children:\"https://ramunarasinga.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My Youtube channel \\u2014 \",(0,n.jsx)(e.a,{href:\"https://www.youtube.com/@thinkthroo\",children:\"https://www.youtube.com/@thinkthroo\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Learning platform \\u2014 \",(0,n.jsx)(e.a,{href:\"https://thinkthroo.com/\",children:\"https://thinkthroo.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Codebase Architecture \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/architecture\",children:\"https://app.thinkthroo.com/architecture\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Best practices \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/best-practices\",children:\"https://app.thinkthroo.com/best-practices\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Production-grade projects \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/production-grade-projects\",children:\"https://app.thinkthroo.com/production-grade-projects\"})]}),`\n`,(0,n.jsx)(e.h1,{id:\"references\",children:(0,n.jsx)(e.strong,{children:\"References:\"})}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/pmndrs/zustand/blob/main/src/traditional.ts#L44\",children:\"https://github.com/pmndrs/zustand/blob/main/src/traditional.ts#L44\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://www.npmjs.com/package/use-sync-external-store\",children:\"https://www.npmjs.com/package/use-sync-external-store\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://legacy.reactjs.org/docs/hooks-reference.html#usesyncexternalstore\",children:\"https://legacy.reactjs.org/docs/hooks-reference.html#usesyncexternalstore\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://react.dev/reference/react/useSyncExternalStore\",children:\"https://react.dev/reference/react/useSyncExternalStore\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/reactwg/react-18/discussions/86\",children:\"https://github.com/reactwg/react-18/discussions/86\"})}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsxs)(e.a,{href:\"https://medium.com/tag/javascript?source=post_page-----5b92cc0f3bf8---------------javascript-----------------\",children:[(0,n.jsx)(e.br,{}),`\n`]})})]})}function d(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,{...t,children:(0,n.jsx)(o,{...t})}):o(t)}return b(E);})();\n;return Component;"
  },
  "_id": "blog/useSyncExternalStoreExports-in-Zustand.mdx",
  "_raw": {
    "sourceFilePath": "blog/useSyncExternalStoreExports-in-Zustand.mdx",
    "sourceFileName": "useSyncExternalStoreExports-in-Zustand.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/useSyncExternalStoreExports-in-Zustand"
  },
  "type": "Doc",
  "slug": "/blog/useSyncExternalStoreExports-in-Zustand",
  "slugAsParams": "useSyncExternalStoreExports-in-Zustand"
}