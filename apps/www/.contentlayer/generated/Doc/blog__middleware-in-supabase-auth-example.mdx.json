{
  "title": "Comparison of the middleware implementation between Supabase Auth documentation and the nextjs-stripe-supabase.\r",
  "published": false,
  "featured": false,
  "component": false,
  "toc": true,
  "body": {
    "raw": "\r\nIn this article, we are going to compare the middleware implementation between Supabase Auth documentation and the nextjs-stripe-supabase.\r\n\r\n* Supabase Auth Documentation\r\n    \r\n\r\nThis is a good starting point for us to understand how the Supabase Auth middleware is configured so we can use that knowledge and draw some conclusions when we compare it with opensource projects such as nextjs-stripe-supabase\r\n\r\n* Middleware in [nextjs-subscription-payments](https://github.com/vercel/nextjs-subscription-payments/blob/main/utils/supabase/middleware.ts).\r\n    \r\n\r\nBut what’s the point of this? well, you will learn few techniques about how middleware for Supabase Auth can be configured.\r\n\r\n![](https://cdn-images-1.medium.com/max/1600/1*ChbTsBQq6lY55VPLBG_dwg.png)\r\n\r\n### Middleware in Supabase Auth Documentation\r\n\r\nAt [step 4 — Hook up middleware in Supabase docs](https://supabase.com/docs/guides/auth/server-side/nextjs), you will find   \r\ncode for `middleware.ts` and `utils/supabase/middleware.ts`.\r\n\r\n#### middleware.ts\r\n\r\nThis below code is picked from Supabase documentation.\r\n\r\n```js\r\nimport { type NextRequest } from 'next/server'\r\nimport { updateSession } from '@/utils/supabase/middleware'\r\nexport async function middleware(request: NextRequest) {\r\n return await updateSession(request)\r\n}\r\nexport const config = {\r\n matcher: [\r\n /*\r\n * Match all request paths except for the ones starting with:\r\n * - _next/static (static files)\r\n * - _next/image (image optimization files)\r\n * - favicon.ico (favicon file)\r\n * Feel free to modify this pattern to include more paths.\r\n */\r\n '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\r\n ],\r\n}\r\n```\r\n\r\n`middleware.ts` has a function named `middleware` and const named `config`. These tiny details are important to keep in mind when comparing middleware in other projects in the later section of this article.\r\n\r\n#### utils/supabase/middleware.ts\r\n\r\nThis below code is picked from Supabase documentation.\r\n\r\n```js\r\nimport { createServerClient, type CookieOptions } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return cookieStore.getAll()\r\n        },\r\n        setAll(cookiesToSet) {\r\n          try {\r\n            cookiesToSet.forEach(({ name, value, options }) =>\r\n              cookieStore.set(name, value, options)\r\n            )\r\n          } catch {\r\n            // The `setAll` method was called from a Server Component.\r\n            // This can be ignored if you have middleware refreshing\r\n            // user sessions.\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\r\n}\r\n```\r\n\r\nImportant steps performed here are:\r\n\r\n1. Create a response object using NextResponse.\r\n    \r\n2. Then create a Supabase client using `CreateServerClient`, response from above step is to `set` and `get` cookies.\r\n    \r\n3. Make a call to getUser(). This step is really important and make sure not to write any additional logic between `createServerClient` and this `getUser` function.\r\n    \r\n4. Redirect if the user is not logged in.\r\n    \r\n5. Return SupabaseResponse.\r\n    \r\n\r\nAlso make sure to read the comments provided to help you understand the code better.\r\n\r\n### Middleware in Nextjs-Subscription-Payments\r\n\r\nBased on the information from the above, found in Supabase Auth documentation, we need to review these below two files:\r\n\r\n* [middleware.ts](https://github.com/vercel/nextjs-subscription-payments/blob/main/middleware.ts)\r\n    \r\n* [utils/supabase/middleware.ts](https://github.com/vercel/nextjs-subscription-payments/blob/main/utils/supabase/middleware.ts)\r\n    \r\n\r\n#### middleware.ts file\r\n\r\nThis below code is picked from [nextjs-subscriptions-payments](https://github.com/vercel/nextjs-subscription-payments/blob/main/middleware.ts).\r\n\r\n```js\r\nimport { type NextRequest } from 'next/server';\r\nimport { updateSession } from '@/utils/supabase/middleware';\r\n\r\nexport async function middleware(request: NextRequest) {\r\n  return await updateSession(request);\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match all request paths except:\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     * - images - .svg, .png, .jpg, .jpeg, .gif, .webp\r\n     * Feel free to modify this pattern to include more paths.\r\n     */\r\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)'\r\n  ]\r\n};\r\n```\r\n\r\nComparing this with what is provided in Supabase auth documentation, there isn’t much difference.\r\n\r\n#### utils/supabase/middleware.ts\r\n\r\nThis below code is picked from [utils/supabase/middleware.ts](https://github.com/vercel/nextjs-subscription-payments/blob/main/utils/supabase/middleware.ts).\r\n\r\n```js\r\nimport { createServerClient, type CookieOptions } from '@supabase/ssr';\r\nimport { type NextRequest, NextResponse } from 'next/server';\r\n\r\nexport const createClient = (request: NextRequest) => {\r\n  // Create an unmodified response\r\n  let response = NextResponse.next({\r\n    request: {\r\n      headers: request.headers\r\n    }\r\n  });\r\n\r\n  const supabase = createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        get(name: string) {\r\n          return request.cookies.get(name)?.value;\r\n        },\r\n        set(name: string, value: string, options: CookieOptions) {\r\n          // If the cookie is updated, update the cookies for the request and response\r\n          request.cookies.set({\r\n            name,\r\n            value,\r\n            ...options\r\n          });\r\n          response = NextResponse.next({\r\n            request: {\r\n              headers: request.headers\r\n            }\r\n          });\r\n          response.cookies.set({\r\n            name,\r\n            value,\r\n            ...options\r\n          });\r\n        },\r\n        remove(name: string, options: CookieOptions) {\r\n          // If the cookie is removed, update the cookies for the request and response\r\n          request.cookies.set({\r\n            name,\r\n            value: '',\r\n            ...options\r\n          });\r\n          response = NextResponse.next({\r\n            request: {\r\n              headers: request.headers\r\n            }\r\n          });\r\n          response.cookies.set({\r\n            name,\r\n            value: '',\r\n            ...options\r\n          });\r\n        }\r\n      }\r\n    }\r\n  );\r\n\r\n  return { supabase, response };\r\n};\r\n\r\nexport const updateSession = async (request: NextRequest) => {\r\n  try {\r\n    // This `try/catch` block is only here for the interactive tutorial.\r\n    // Feel free to remove once you have Supabase connected.\r\n    const { supabase, response } = createClient(request);\r\n\r\n    // This will refresh session if expired - required for Server Components\r\n    // https://supabase.com/docs/guides/auth/server-side/nextjs\r\n    await supabase.auth.getUser();\r\n\r\n    return response;\r\n  } catch (e) {\r\n    // If you are here, a Supabase client could not be created!\r\n    // This is likely because you have not set up environment variables.\r\n    // Check out http://localhost:3000 for Next Steps.\r\n    return NextResponse.next({\r\n      request: {\r\n        headers: request.headers\r\n      }\r\n    });\r\n  }\r\n};\r\n```\r\n\r\nComparing this with documentation, you will see the below differences:\r\n\r\n1. `updateSession` function is found in both, the documentation and this example above.\r\n    \r\n2. There is a difference in the way client is created. In the Supabase Auth documentation, Supabase client is created with in the `updateSession` function itself, you do not see another function called. This is the  \r\n    case in `updateSession`. `createClient` function is called.\r\n    \r\n3. `createClient` looks very similar to the documentation. Except the cookies are handled differently. You will see functions such as `set` and `get` in this above example, whereas the Supabase auth documentation  \r\n    uses methods such as `setAll` and `getAll`. Both of these found to update the necessary cookies on `request` and `response`.\r\n    \r\n4. The important step here is to call the `await supabase.auth.getUser()` and the comment just above this line in the above example —   \r\n    “  \r\n    // This will refresh session if expired — required for Server Components  \r\n    // [https://supabase.com/docs/guides/auth/server-side/nextjs](https://supabase.com/docs/guides/auth/server-side/nextjs)  \r\n    “  \r\n    signifies that this line here is really important.\r\n    \r\n5. There are redirects found to be happening in this example’s `updateSession`, but in the Supabase Auth documentation, you will see some redirects happening if the user does not exist. That’s not to say  \r\n    [nextjs-supscription-payments](https://github.com/vercel/nextjs-subscription-payments/blob/main/utils/supabase/middleware.ts) does not have redirects, it just happens in a different file. For example — [signin/\\[id\\]/page.tsx](https://github.com/vercel/nextjs-subscription-payments/blob/main/app/signin/%5Bid%5D/page.tsx#L47-L55)\r\n    \r\n# **About me:**\r\n\r\nHey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\r\n\r\nI am open to work on interesting projects. Send me an email at ramu.narasinga@gmail.com\r\n\r\nMy Github — [https://github.com/ramu-narasinga](https://github.com/ramu-narasinga)\r\n\r\nMy website — [https://ramunarasinga.com](https://ramunarasinga.com/)\r\n\r\nMy Youtube channel — [https://www.youtube.com/@thinkthroo](https://www.youtube.com/@thinkthroo)\r\n\r\nLearning platform — [https://thinkthroo.com](https://thinkthroo.com/)\r\n\r\nCodebase Architecture — [https://app.thinkthroo.com/architecture](https://app.thinkthroo.com/architecture)\r\n\r\nBest practices — [https://app.thinkthroo.com/best-practices](https://app.thinkthroo.com/best-practices)\r\n\r\nProduction-grade projects — [https://app.thinkthroo.com/production-grade-projects](https://app.thinkthroo.com/production-grade-projects)\r\n\r\n### References:\r\n\r\n1. [https://supabase.com/docs/guides/auth/server-side/nextjs](https://supabase.com/docs/guides/auth/server-side/nextjs)\r\n    \r\n2. [https://github.com/midday-ai/midday/blob/main/apps/dashboard/src/middleware.ts](https://github.com/midday-ai/midday/blob/main/apps/dashboard/src/middleware.ts)\r\n    \r\n3. [https://github.com/vercel/nextjs-subscription-payments/blob/main/middleware.ts](https://github.com/vercel/nextjs-subscription-payments/blob/main/middleware.ts)\r\n    \r\n4. [https://github.com/vercel/nextjs-subscription-payments/blob/main/app/signin/%5Bid%5D/page.tsx#L47-L55](https://github.com/vercel/nextjs-subscription-payments/blob/main/app/signin/%5Bid%5D/page.tsx#L47-L55)\r\n",
    "code": "var Component=(()=>{var h=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var b=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),N=(n,e)=>{for(var s in e)c(n,s,{get:e[s],enumerable:!0})},a=(n,e,s,o)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of y(e))!u.call(n,r)&&r!==s&&c(n,r,{get:()=>e[r],enumerable:!(o=p(e,r))||o.enumerable});return n};var f=(n,e,s)=>(s=n!=null?h(m(n)):{},a(e||!n||!n.__esModule?c(s,\"default\",{value:n,enumerable:!0}):s,n)),g=n=>a(c({},\"__esModule\",{value:!0}),n);var F=b((j,i)=>{i.exports=_jsx_runtime});var x={};N(x,{default:()=>d,frontmatter:()=>w});var l=f(F()),w={title:\"Comparison of the middleware implementation between Supabase Auth documentation and the nextjs-stripe-supabase.\"};function t(n){let e={a:\"a\",br:\"br\",code:\"code\",div:\"div\",h1:\"h1\",h3:\"h3\",h4:\"h4\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.p,{children:\"In this article, we are going to compare the middleware implementation between Supabase Auth documentation and the nextjs-stripe-supabase.\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:\"Supabase Auth Documentation\"}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:\"This is a good starting point for us to understand how the Supabase Auth middleware is configured so we can use that knowledge and draw some conclusions when we compare it with opensource projects such as nextjs-stripe-supabase\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsxs)(e.li,{children:[\"Middleware in \",(0,l.jsx)(e.a,{href:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/utils/supabase/middleware.ts\",children:\"nextjs-subscription-payments\"}),\".\"]}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:\"But what\\u2019s the point of this? well, you will learn few techniques about how middleware for Supabase Auth can be configured.\"}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.img,{src:\"https://cdn-images-1.medium.com/max/1600/1*ChbTsBQq6lY55VPLBG_dwg.png\",alt:\"\"})}),`\n`,(0,l.jsx)(e.h3,{id:\"middleware-in-supabase-auth-documentation\",children:\"Middleware in Supabase Auth Documentation\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"At \",(0,l.jsx)(e.a,{href:\"https://supabase.com/docs/guides/auth/server-side/nextjs\",children:\"step 4\\u200A\\u2014\\u200AHook up middleware in Supabase docs\"}),\", you will find\\xA0\",(0,l.jsx)(e.br,{}),`\n`,\"code for \",(0,l.jsx)(e.code,{children:\"middleware.ts\"}),\" and \",(0,l.jsx)(e.code,{children:\"utils/supabase/middleware.ts\"}),\".\"]}),`\n`,(0,l.jsx)(e.h4,{id:\"middlewarets\",children:\"middleware.ts\"}),`\n`,(0,l.jsx)(e.p,{children:\"This below code is picked from Supabase documentation.\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"js\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"js\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" type\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextRequest \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" from\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" 'next/server'\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" updateSession \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" from\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" '@/utils/supabase/middleware'\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" async\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" function\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" middleware\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" NextRequest\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" return\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" await\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" updateSession\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" const\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" config \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" matcher\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" [\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" /*\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" * Match all request paths except for the ones starting with:\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" * - _next/static (static files)\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" * - _next/image (image optimization files)\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" * - favicon.ico (favicon file)\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" * Feel free to modify this pattern to include more paths.\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" */\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" '/((?!_next/static|_next/image|favicon.ico|.*\\\\\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)'\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" ],\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"})})]})})}),`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:\"middleware.ts\"}),\" has a function named \",(0,l.jsx)(e.code,{children:\"middleware\"}),\" and const named \",(0,l.jsx)(e.code,{children:\"config\"}),\". These tiny details are important to keep in mind when comparing middleware in other projects in the later section of this article.\"]}),`\n`,(0,l.jsx)(e.h4,{id:\"utilssupabasemiddlewarets\",children:\"utils/supabase/middleware.ts\"}),`\n`,(0,l.jsx)(e.p,{children:\"This below code is picked from Supabase documentation.\"}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"js\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"js\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" createServerClient\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" type\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" CookieOptions \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" from\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" '@supabase/ssr'\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" cookies \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" from\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" 'next/headers'\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" async\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" function\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" createClient\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  const\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" cookieStore \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" await\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" cookies\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"()\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  return\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" createServerClient\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"    process\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"env\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"NEXT_PUBLIC_SUPABASE_URL\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"!,\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"    process\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"env\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"NEXT_PUBLIC_SUPABASE_ANON_KEY\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"!,\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    {\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"      cookies\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\"        getAll\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          return\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" cookieStore\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"getAll\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"()\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"        },\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\"        setAll\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"cookiesToSet\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          try\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            cookiesToSet\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"forEach\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(({\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" name\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" value\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" options \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"})\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" =>\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"              cookieStore\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"set\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" value\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" options\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"            )\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          }\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" catch\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"            //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" The `setAll` method was called from a Server Component.\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"            //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" This can be ignored if you have middleware refreshing\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"            //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" user sessions.\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          }\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"        },\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"      },\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    }\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  )\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"})})]})})}),`\n`,(0,l.jsx)(e.p,{children:\"Important steps performed here are:\"}),`\n`,(0,l.jsxs)(e.ol,{children:[`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsx)(e.p,{children:\"Create a response object using NextResponse.\"}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsxs)(e.p,{children:[\"Then create a Supabase client using \",(0,l.jsx)(e.code,{children:\"CreateServerClient\"}),\", response from above step is to \",(0,l.jsx)(e.code,{children:\"set\"}),\" and \",(0,l.jsx)(e.code,{children:\"get\"}),\" cookies.\"]}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsxs)(e.p,{children:[\"Make a call to getUser(). This step is really important and make sure not to write any additional logic between \",(0,l.jsx)(e.code,{children:\"createServerClient\"}),\" and this \",(0,l.jsx)(e.code,{children:\"getUser\"}),\" function.\"]}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsx)(e.p,{children:\"Redirect if the user is not logged in.\"}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsx)(e.p,{children:\"Return SupabaseResponse.\"}),`\n`]}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:\"Also make sure to read the comments provided to help you understand the code better.\"}),`\n`,(0,l.jsx)(e.h3,{id:\"middleware-in-nextjs-subscription-payments\",children:\"Middleware in Nextjs-Subscription-Payments\"}),`\n`,(0,l.jsx)(e.p,{children:\"Based on the information from the above, found in Supabase Auth documentation, we need to review these below two files:\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.a,{href:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/middleware.ts\",children:\"middleware.ts\"})}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.a,{href:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/utils/supabase/middleware.ts\",children:\"utils/supabase/middleware.ts\"})}),`\n`]}),`\n`]}),`\n`,(0,l.jsx)(e.h4,{id:\"middlewarets-file\",children:\"middleware.ts file\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"This below code is picked from \",(0,l.jsx)(e.a,{href:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/middleware.ts\",children:\"nextjs-subscriptions-payments\"}),\".\"]}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"js\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"js\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" type\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextRequest \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" from\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" 'next/server'\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" updateSession \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" from\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" '@/utils/supabase/middleware'\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" async\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" function\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" middleware\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" NextRequest\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  return\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" await\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" updateSession\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\");\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" const\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" config \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"  matcher\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" [\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    /*\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\"     * Match all request paths except:\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\"     * - _next/static (static files)\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\"     * - _next/image (image optimization files)\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\"     * - favicon.ico (favicon file)\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\"     * - images - .svg, .png, .jpg, .jpeg, .gif, .webp\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\"     * Feel free to modify this pattern to include more paths.\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"     */\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    '/((?!_next/static|_next/image|favicon.ico|.*\\\\\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)'\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  ]\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"};\"})})]})})}),`\n`,(0,l.jsx)(e.p,{children:\"Comparing this with what is provided in Supabase auth documentation, there isn\\u2019t much difference.\"}),`\n`,(0,l.jsx)(e.h4,{id:\"utilssupabasemiddlewarets-1\",children:\"utils/supabase/middleware.ts\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"This below code is picked from \",(0,l.jsx)(e.a,{href:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/utils/supabase/middleware.ts\",children:\"utils/supabase/middleware.ts\"}),\".\"]}),`\n`,(0,l.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,l.jsx)(e.pre,{\"data-language\":\"js\",\"data-theme\":\"default\",children:(0,l.jsxs)(e.code,{\"data-language\":\"js\",\"data-theme\":\"default\",children:[(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" createServerClient\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" type\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" CookieOptions \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" from\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" '@supabase/ssr'\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" type\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextRequest\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextResponse \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" from\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" 'next/server'\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" const\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" createClient\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" =\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" NextRequest\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" =>\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" Create an unmodified response\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  let\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" response \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"next\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"({\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"    request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"      headers\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"headers\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    }\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  });\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  const\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" supabase \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" createServerClient\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"    process\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"env\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"NEXT_PUBLIC_SUPABASE_URL\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"!,\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"    process\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"env\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"NEXT_PUBLIC_SUPABASE_ANON_KEY\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"!,\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    {\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"      cookies\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\"        get\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" string\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          return\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"cookies\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"get\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")?.\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"value\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\";\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"        },\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\"        set\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" string\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" value\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" string\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" options\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" CookieOptions\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" If the cookie is updated, update the cookies for the request and response\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"          request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"cookies\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"set\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"({\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            name\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            value\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"            ...\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"options\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          });\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"          response \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"next\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"({\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"              headers\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"headers\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"            }\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          });\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"          response\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"cookies\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"set\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"({\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            name\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            value\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"            ...\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"options\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          });\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"        },\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\"        remove\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" string\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" options\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" CookieOptions\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" If the cookie is removed, update the cookies for the request and response\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"          request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"cookies\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"set\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"({\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            name\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            value\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" ''\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"            ...\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"options\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          });\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"          response \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"next\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"({\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"              headers\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"headers\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"            }\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          });\"})}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"          response\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"cookies\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"set\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"({\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            name\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"            value\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" ''\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"            ...\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"options\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"          });\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"        }\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"      }\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    }\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  );\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  return\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" supabase\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" response \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"};\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"};\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" const\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" updateSession\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" =\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" async\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\",fontWeight:\"bold\"},children:\" NextRequest\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" =>\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  try\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" This `try/catch` block is only here for the interactive tutorial.\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" Feel free to remove once you have Supabase connected.\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    const\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" supabase\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" response \"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" =\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" createClient\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\");\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" This will refresh session if expired - required for Server Components\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" https://supabase.com/docs/guides/auth/server-side/nextjs\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    await\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" supabase\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"auth\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"getUser\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"();\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:\" \"}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    return\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" response\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\";\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  }\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" catch\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"e\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" If you are here, a Supabase client could not be created!\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" This is likely because you have not set up environment variables.\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    //\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF4\"},children:\" Check out http://localhost:3000 for Next Steps.\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    return\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" NextResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"next\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"({\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"      request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\" {\"})]}),`\n`,(0,l.jsxs)(e.span,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"        headers\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\" request\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFF\"},children:\"headers\"})]}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"      }\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"    });\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"  }\"})}),`\n`,(0,l.jsx)(e.span,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FFF8\"},children:\"};\"})})]})})}),`\n`,(0,l.jsx)(e.p,{children:\"Comparing this with documentation, you will see the below differences:\"}),`\n`,(0,l.jsxs)(e.ol,{children:[`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:\"updateSession\"}),\" function is found in both, the documentation and this example above.\"]}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsxs)(e.p,{children:[\"There is a difference in the way client is created. In the Supabase Auth documentation, Supabase client is created with in the \",(0,l.jsx)(e.code,{children:\"updateSession\"}),\" function itself, you do not see another function called. This is the\",(0,l.jsx)(e.br,{}),`\n`,\"case in \",(0,l.jsx)(e.code,{children:\"updateSession\"}),\". \",(0,l.jsx)(e.code,{children:\"createClient\"}),\" function is called.\"]}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:\"createClient\"}),\" looks very similar to the documentation. Except the cookies are handled differently. You will see functions such as \",(0,l.jsx)(e.code,{children:\"set\"}),\" and \",(0,l.jsx)(e.code,{children:\"get\"}),\" in this above example, whereas the Supabase auth documentation\",(0,l.jsx)(e.br,{}),`\n`,\"uses methods such as \",(0,l.jsx)(e.code,{children:\"setAll\"}),\" and \",(0,l.jsx)(e.code,{children:\"getAll\"}),\". Both of these found to update the necessary cookies on \",(0,l.jsx)(e.code,{children:\"request\"}),\" and \",(0,l.jsx)(e.code,{children:\"response\"}),\".\"]}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsxs)(e.p,{children:[\"The important step here is to call the \",(0,l.jsx)(e.code,{children:\"await supabase.auth.getUser()\"}),\" and the comment just above this line in the above example\\u200A\\u2014\\u200A\",(0,l.jsx)(e.br,{}),`\n`,\"\\u201C\",(0,l.jsx)(e.br,{}),`\n`,\"// This will refresh session if expired\\u200A\\u2014\\u200Arequired for Server Components\",(0,l.jsx)(e.br,{}),`\n`,\"// \",(0,l.jsx)(e.a,{href:\"https://supabase.com/docs/guides/auth/server-side/nextjs\",children:\"https://supabase.com/docs/guides/auth/server-side/nextjs\"}),(0,l.jsx)(e.br,{}),`\n`,\"\\u201C\",(0,l.jsx)(e.br,{}),`\n`,\"signifies that this line here is really important.\"]}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsxs)(e.p,{children:[\"There are redirects found to be happening in this example\\u2019s \",(0,l.jsx)(e.code,{children:\"updateSession\"}),\", but in the Supabase Auth documentation, you will see some redirects happening if the user does not exist. That\\u2019s not to say\",(0,l.jsx)(e.br,{}),`\n`,(0,l.jsx)(e.a,{href:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/utils/supabase/middleware.ts\",children:\"nextjs-supscription-payments\"}),\" does not have redirects, it just happens in a different file. For example\\u200A\\u2014\\u200A\",(0,l.jsx)(e.a,{href:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/app/signin/%5Bid%5D/page.tsx#L47-L55\",children:\"signin/[id]/page.tsx\"})]}),`\n`]}),`\n`]}),`\n`,(0,l.jsx)(e.h1,{id:\"about-me\",children:(0,l.jsx)(e.strong,{children:\"About me:\"})}),`\n`,(0,l.jsx)(e.p,{children:\"Hey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"I am open to work on interesting projects. Send me an email at \",(0,l.jsx)(e.a,{href:\"mailto:ramu.narasinga@gmail.com\",children:\"ramu.narasinga@gmail.com\"})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"My Github \\u2014 \",(0,l.jsx)(e.a,{href:\"https://github.com/ramu-narasinga\",children:\"https://github.com/ramu-narasinga\"})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"My website \\u2014 \",(0,l.jsx)(e.a,{href:\"https://ramunarasinga.com/\",children:\"https://ramunarasinga.com\"})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"My Youtube channel \\u2014 \",(0,l.jsx)(e.a,{href:\"https://www.youtube.com/@thinkthroo\",children:\"https://www.youtube.com/@thinkthroo\"})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Learning platform \\u2014 \",(0,l.jsx)(e.a,{href:\"https://thinkthroo.com/\",children:\"https://thinkthroo.com\"})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Codebase Architecture \\u2014 \",(0,l.jsx)(e.a,{href:\"https://app.thinkthroo.com/architecture\",children:\"https://app.thinkthroo.com/architecture\"})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Best practices \\u2014 \",(0,l.jsx)(e.a,{href:\"https://app.thinkthroo.com/best-practices\",children:\"https://app.thinkthroo.com/best-practices\"})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Production-grade projects \\u2014 \",(0,l.jsx)(e.a,{href:\"https://app.thinkthroo.com/production-grade-projects\",children:\"https://app.thinkthroo.com/production-grade-projects\"})]}),`\n`,(0,l.jsx)(e.h3,{id:\"references\",children:\"References:\"}),`\n`,(0,l.jsxs)(e.ol,{children:[`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.a,{href:\"https://supabase.com/docs/guides/auth/server-side/nextjs\",children:\"https://supabase.com/docs/guides/auth/server-side/nextjs\"})}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.a,{href:\"https://github.com/midday-ai/midday/blob/main/apps/dashboard/src/middleware.ts\",children:\"https://github.com/midday-ai/midday/blob/main/apps/dashboard/src/middleware.ts\"})}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.a,{href:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/middleware.ts\",children:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/middleware.ts\"})}),`\n`]}),`\n`,(0,l.jsxs)(e.li,{children:[`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.a,{href:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/app/signin/%5Bid%5D/page.tsx#L47-L55\",children:\"https://github.com/vercel/nextjs-subscription-payments/blob/main/app/signin/%5Bid%5D/page.tsx#L47-L55\"})}),`\n`]}),`\n`]})]})}function d(n={}){let{wrapper:e}=n.components||{};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(t,{...n})}):t(n)}return g(x);})();\n;return Component;"
  },
  "_id": "blog/middleware-in-supabase-auth-example.mdx",
  "_raw": {
    "sourceFilePath": "blog/middleware-in-supabase-auth-example.mdx",
    "sourceFileName": "middleware-in-supabase-auth-example.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/middleware-in-supabase-auth-example"
  },
  "type": "Doc",
  "slug": "/blog/middleware-in-supabase-auth-example",
  "slugAsParams": "middleware-in-supabase-auth-example"
}