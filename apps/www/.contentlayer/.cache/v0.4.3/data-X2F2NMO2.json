{
  "cacheItemsMap": {
    "blog/analyzeSizeChange-script-in-tRPC.mdx": {
      "document": {
        "title": "analyzeSizeChange script in tRPC source code\r",
        "published": false,
        "featured": false,
        "component": false,
        "toc": true,
        "body": {
          "raw": "\r\nIn this article, we provide an overview of [analyzeSizeChange script in trpc source code](https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts).\r\n\r\nThis file has the following functions:\r\n\r\n1\\. func analyzeSizeChange  \r\n2\\. func onAnalysis  \r\n3\\. type GitHubLogType  \r\n4\\. type GitHubLogOptions  \r\n5\\. func logNewModule  \r\n6\\. func logDifference  \r\n7\\. func logGithubMessage  \r\n8\\. func difference  \r\n9\\. func resolveJsonPaths  \r\n10\\. func stripAnsiEscapes  \r\n11\\. func formatGithubOptions  \r\n12\\. func formatGithubMessage\r\n\r\n![](https://miro.medium.com/v2/resize:fit:875/1*5bZryISMnFUikOk1liDFag.png)\r\n\r\nThe most important function here is analyzeSizeChange because it has a function named onAnalysis.\r\n\r\n```plaintext\r\nexport default function analyzeSizeChange(packageDir: string) {\r\n let analyzePluginIterations = 0;\r\n return analyze({\r\n summaryOnly: process.env.CI ? undefined : true,\r\n skipFormatted: process.env.CI ? true : undefined,\r\n onAnalysis: (analysis) => {\r\n …\r\n // calls logDifference\r\n if (prevModule) {\r\n logDifference(\r\n `Module '${module.id}'`,\r\n prevModule.size,\r\n module.size,\r\n );\r\n } else {\r\n logNewModule(module.id, module.size);\r\n }\r\n …\r\n })\r\n}\r\n```\r\n\r\nlogDifference and logNewModule are in this same file and are colocated. This is for readability and reusability purposes.\r\n\r\n# **logNewModule:**\r\n\r\n```plaintext\r\nfunction logNewModule(name: string, size: number) {\r\n if (size < ABSOLUTE_BYTE_CHANGE_THRESHOLD) {\r\n   return;\r\n }\r\n const type = 'notice';\r\n const options = {\r\n   title: `New Module (${size} bytes in ${name})`,\r\n };\r\n const message = `${name} size: ${size} bytes`;\r\n logGithubMessage(type, message, options);\r\n}\r\n```\r\n\r\nlogNewModule calls a function named logGithubMessage that is located somewhere at the bottom of this same file after this  \r\nfunction.\r\n\r\n# **logDifference:**\r\n\r\n```plaintext\r\nfunction logDifference(name: string, before: number, after: number) {\r\n const change = difference(before, after);\r\n if (\r\n   change.absolute < ABSOLUTE_BYTE_CHANGE_THRESHOLD &&\r\n   change.percent < PERCENT_CHANGE_THRESHOLD\r\n ) {\r\n   return;\r\n }\r\n const type = 'error';\r\n const options = {\r\n   title: `Important Size Change (${change.absolute} bytes in ${name})`,\r\n };\r\n const message = `${name} size change: ${\r\n   change.absolute\r\n } bytes (${change.percent.toFixed(2)}%)`;\r\n logGithubMessage(type, message, options);\r\n}\r\n```\r\n\r\n`logDifference` calls logGithubMessage and difference functions, at this point, we can see that function heierarchy is  \r\nfrom top to bottom, core functions are ranked higher while single responsibility functions are positioned lower.\r\n\r\n# **logGithubMessage**\r\n\r\n```plaintext\r\nfunction logGithubMessage(\r\n type: GitHubLogType,\r\n message: string,\r\n options: GitHubLogOptions = {},\r\n) {\r\n console.log(\r\n   stripAnsiEscapes(\r\n   `::${type} ${formatGithubOptions(options)}::${formatGithubMessage(\r\n   message,\r\n   )\r\n}`,\r\n),\r\n );\r\n}\r\n```\r\n\r\nlogGithubMessage uses three functions — stripAnsiEscapes, formatGithubOptions and formatGithubMessage.\r\n\r\n# **About me:**\r\n\r\nHey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\r\n\r\nI am open to work on interesting projects. Send me an email at ramu.narasinga@gmail.com\r\n\r\nMy Github — [https://github.com/ramu-narasinga](https://github.com/ramu-narasinga)\r\n\r\nMy website — [https://ramunarasinga.com](https://ramunarasinga.com/)\r\n\r\nMy Youtube channel — [https://www.youtube.com/@thinkthroo](https://www.youtube.com/@thinkthroo)\r\n\r\nLearning platform — [https://thinkthroo.com](https://thinkthroo.com/)\r\n\r\nCodebase Architecture — [https://app.thinkthroo.com/architecture](https://app.thinkthroo.com/architecture)\r\n\r\nBest practices — [https://app.thinkthroo.com/best-practices](https://app.thinkthroo.com/best-practices)\r\n\r\nProduction-grade projects — [https://app.thinkthroo.com/production-grade-projects](https://app.thinkthroo.com/production-grade-projects)\r\n\r\n# **References:**\r\n\r\n1\\. https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts\r\n\r\n[  \r\n](https://medium.com/tag/javascript?source=post_page-----b216f5ea61ff--------------------------------)\r\n",
          "code": "var Component=(()=>{var o=Object.create;var l=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var b=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),N=(a,e)=>{for(var s in e)l(a,s,{get:e[s],enumerable:!0})},c=(a,e,s,r)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let i of u(e))!f.call(a,i)&&i!==s&&l(a,i,{get:()=>e[i],enumerable:!(r=m(e,i))||r.enumerable});return a};var y=(a,e,s)=>(s=a!=null?o(g(a)):{},c(e||!a||!a.__esModule?l(s,\"default\",{value:a,enumerable:!0}):s,a)),z=a=>c(l({},\"__esModule\",{value:!0}),a);var h=b((G,t)=>{t.exports=_jsx_runtime});var w={};N(w,{default:()=>p,frontmatter:()=>M});var n=y(h()),M={title:\"analyzeSizeChange script in tRPC source code\"};function d(a){let e={a:\"a\",br:\"br\",code:\"code\",div:\"div\",h1:\"h1\",img:\"img\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...a.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"In this article, we provide an overview of \",(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts\",children:\"analyzeSizeChange script in trpc source code\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"This file has the following functions:\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"1. func analyzeSizeChange\",(0,n.jsx)(e.br,{}),`\n`,\"2. func onAnalysis\",(0,n.jsx)(e.br,{}),`\n`,\"3. type GitHubLogType\",(0,n.jsx)(e.br,{}),`\n`,\"4. type GitHubLogOptions\",(0,n.jsx)(e.br,{}),`\n`,\"5. func logNewModule\",(0,n.jsx)(e.br,{}),`\n`,\"6. func logDifference\",(0,n.jsx)(e.br,{}),`\n`,\"7. func logGithubMessage\",(0,n.jsx)(e.br,{}),`\n`,\"8. func difference\",(0,n.jsx)(e.br,{}),`\n`,\"9. func resolveJsonPaths\",(0,n.jsx)(e.br,{}),`\n`,\"10. func stripAnsiEscapes\",(0,n.jsx)(e.br,{}),`\n`,\"11. func formatGithubOptions\",(0,n.jsx)(e.br,{}),`\n`,\"12. func formatGithubMessage\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://miro.medium.com/v2/resize:fit:875/1*5bZryISMnFUikOk1liDFag.png\",alt:\"\"})}),`\n`,(0,n.jsx)(e.p,{children:\"The most important function here is analyzeSizeChange because it has a function named onAnalysis.\"}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"export default function analyzeSizeChange(packageDir: string) {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" let analyzePluginIterations = 0;\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" return analyze({\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" summaryOnly: process.env.CI ? undefined : true,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" skipFormatted: process.env.CI ? true : undefined,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" onAnalysis: (analysis) => {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" \\u2026\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" // calls logDifference\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" if (prevModule) {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" logDifference(\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" `Module '${module.id}'`,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" prevModule.size,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" module.size,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" );\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" } else {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" logNewModule(module.id, module.size);\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" }\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" \\u2026\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" })\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"}\"})})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"logDifference and logNewModule are in this same file and are colocated. This is for readability and reusability purposes.\"}),`\n`,(0,n.jsx)(e.h1,{id:\"lognewmodule\",children:(0,n.jsx)(e.strong,{children:\"logNewModule:\"})}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"function logNewModule(name: string, size: number) {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" if (size < ABSOLUTE_BYTE_CHANGE_THRESHOLD) {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   return;\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" }\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" const type = 'notice';\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" const options = {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   title: `New Module (${size} bytes in ${name})`,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" };\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" const message = `${name} size: ${size} bytes`;\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" logGithubMessage(type, message, options);\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"}\"})})]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"logNewModule calls a function named logGithubMessage that is located somewhere at the bottom of this same file after this\",(0,n.jsx)(e.br,{}),`\n`,\"function.\"]}),`\n`,(0,n.jsx)(e.h1,{id:\"logdifference\",children:(0,n.jsx)(e.strong,{children:\"logDifference:\"})}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"function logDifference(name: string, before: number, after: number) {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" const change = difference(before, after);\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" if (\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   change.absolute < ABSOLUTE_BYTE_CHANGE_THRESHOLD &&\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   change.percent < PERCENT_CHANGE_THRESHOLD\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" ) {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   return;\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" }\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" const type = 'error';\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" const options = {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   title: `Important Size Change (${change.absolute} bytes in ${name})`,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" };\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" const message = `${name} size change: ${\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   change.absolute\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" } bytes (${change.percent.toFixed(2)}%)`;\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" logGithubMessage(type, message, options);\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"}\"})})]})})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"logDifference\"}),\" calls logGithubMessage and difference functions, at this point, we can see that function heierarchy is\",(0,n.jsx)(e.br,{}),`\n`,\"from top to bottom, core functions are ranked higher while single responsibility functions are positioned lower.\"]}),`\n`,(0,n.jsx)(e.h1,{id:\"loggithubmessage\",children:(0,n.jsx)(e.strong,{children:\"logGithubMessage\"})}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"function logGithubMessage(\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" type: GitHubLogType,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" message: string,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" options: GitHubLogOptions = {},\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\") {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" console.log(\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   stripAnsiEscapes(\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   `::${type} ${formatGithubOptions(options)}::${formatGithubMessage(\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   message,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   )\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"}`,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"),\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" );\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"}\"})})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"logGithubMessage uses three functions \\u2014 stripAnsiEscapes, formatGithubOptions and formatGithubMessage.\"}),`\n`,(0,n.jsx)(e.h1,{id:\"about-me\",children:(0,n.jsx)(e.strong,{children:\"About me:\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Hey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I am open to work on interesting projects. Send me an email at \",(0,n.jsx)(e.a,{href:\"mailto:ramu.narasinga@gmail.com\",children:\"ramu.narasinga@gmail.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My Github \\u2014 \",(0,n.jsx)(e.a,{href:\"https://github.com/ramu-narasinga\",children:\"https://github.com/ramu-narasinga\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My website \\u2014 \",(0,n.jsx)(e.a,{href:\"https://ramunarasinga.com/\",children:\"https://ramunarasinga.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My Youtube channel \\u2014 \",(0,n.jsx)(e.a,{href:\"https://www.youtube.com/@thinkthroo\",children:\"https://www.youtube.com/@thinkthroo\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Learning platform \\u2014 \",(0,n.jsx)(e.a,{href:\"https://thinkthroo.com/\",children:\"https://thinkthroo.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Codebase Architecture \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/architecture\",children:\"https://app.thinkthroo.com/architecture\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Best practices \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/best-practices\",children:\"https://app.thinkthroo.com/best-practices\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Production-grade projects \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/production-grade-projects\",children:\"https://app.thinkthroo.com/production-grade-projects\"})]}),`\n`,(0,n.jsx)(e.h1,{id:\"references\",children:(0,n.jsx)(e.strong,{children:\"References:\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"1. \",(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts\",children:\"https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts\"})]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsxs)(e.a,{href:\"https://medium.com/tag/javascript?source=post_page-----b216f5ea61ff--------------------------------\",children:[(0,n.jsx)(e.br,{}),`\n`]})})]})}function p(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,{...a,children:(0,n.jsx)(d,{...a})}):d(a)}return z(w);})();\n;return Component;"
        },
        "_id": "blog/analyzeSizeChange-script-in-tRPC.mdx",
        "_raw": {
          "sourceFilePath": "blog/analyzeSizeChange-script-in-tRPC.mdx",
          "sourceFileName": "analyzeSizeChange-script-in-tRPC.mdx",
          "sourceFileDir": "blog",
          "contentType": "mdx",
          "flattenedPath": "blog/analyzeSizeChange-script-in-tRPC"
        },
        "type": "Doc",
        "slug": "/blog/analyzeSizeChange-script-in-tRPC",
        "slugAsParams": "analyzeSizeChange-script-in-tRPC"
      },
      "documentHash": "1744009498243",
      "hasWarnings": false,
      "documentTypeName": "Doc"
    }
  }
}
