{
  "title": "rollup-plugin-analyzer usage in trpc scripts\r",
  "published": false,
  "featured": false,
  "component": false,
  "toc": true,
  "body": {
    "raw": "\r\nIn the previous article, we provided a mental picture of functions in [analyzeSizeChange.ts file](https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts), In this article, let’s find out how the actual size change is analyzed.\r\n\r\n```plaintext\r\nimport analyze from 'rollup-plugin-analyzer';\r\nexport default function analyzeSizeChange(packageDir: string) {\r\n let analyzePluginIterations = 0;\r\n return analyze({\r\n   summaryOnly: process.env.CI ? undefined : true,\r\n   skipFormatted: process.env.CI ? true : undefined,\r\n   onAnalysis: (analysis) => {\r\n   },\r\n });\r\n}\r\n```\r\n\r\n`analyze` is imported from `rollup-plugin-analyzer`. It’s got an object as param with [options](https://www.npmjs.com/package/rollup-plugin-analyzer#options):\r\n\r\n1. summaryOnly — Only output bundle summary and module usage bar graphs\r\n    \r\n2. skipFormatted — Don’t output formatted string\r\n    \r\n3. onAnalysis — Callback to be invoked with analysis object (I copied the below description for onAnalysis from npm:)\r\n    \r\n\r\nfunction will be invoked with:  \r\n\\- analysisObject (Object)  \r\n\\- bundleSize (Number) — rendered bundle size in bytes  \r\n\\- bundleOrigSize (Number) — original bundle size in bytes  \r\n\\- bundleReduction (Number) — percentage of rendered bundle size reduction  \r\n\\- moduleCount (Number) — Count of all included modules  \r\n\\- modules (Array) — array of module analysis objects  \r\n\\- module (Object)  \r\n\\- id (String) — path of module / rollup module id  \r\n\\- size (Number) — size of rendered module code in bytes  \r\n\\- origSize (Number) — size of module’s original code in bytes  \r\n\\- dependents (Array) — list of dependent module ids / paths  \r\n\\- percent (Number) — percentage of module size relative to entire bundle  \r\n\\- reduction (Number) — percentage of rendered size reduction  \r\n\\- renderedExports (Array) — list of used named exports  \r\n\\- removedExports (Array) — list of unused named exports\r\n\r\nLet’s see how many of these options are actually used in [analyzeSizeChange file.](https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts)  \r\n\\- [bundleSize](https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts#L36)  \r\n\\- [modules](https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts#L38)\r\n\r\nJust these are found to be used in analyzeSizeChange.ts\r\n\r\nBut in what circumstances is this script executed? is it after you check in some code? does it report on a pull request? To find that out, we need to go where the code takes us.\r\n\r\nYou would have to first search for `analyzeSizeChange` to see where it is used. It is found to be used in [script/getRollupConfig.ts](https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/scripts/getRollupConfig.ts#L9)\r\n\r\n![](https://miro.medium.com/v2/resize:fit:875/1*RPGfbTRlwfJg8rhGwP-Pvg.png)\r\n\r\nNext, you would have to find out where getRollupConfig is used. It is used in a lot of [packages](https://github.com/search?q=repo%3Atrpc%2Ftrpc+getRollupConfig&type=code).\r\n\r\n![](https://miro.medium.com/v2/resize:fit:875/1*zM814-Ubj1vNcOgzudevBw.png)\r\n\r\nbut I picked [packages/client/rollup.config.ts](https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/packages/client/rollup.config.ts#L3), this rollup config is used in the build script.\r\n\r\n```plaintext\r\n\"scripts\": {\r\n \"build\": \"rollup - config rollup.config.ts - configPlugin rollup-plugin-swc3\",\r\n```\r\n\r\nSo the answer, you will have the bundle size changes when you build a package in tRPC source code.\r\n\r\n# **About me:**\r\n\r\nHey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\r\n\r\nI am open to work on interesting projects. Send me an email at ramu.narasinga@gmail.com\r\n\r\nMy Github — [https://github.com/ramu-narasinga](https://github.com/ramu-narasinga)\r\n\r\nMy website — [https://ramunarasinga.com](https://ramunarasinga.com/)\r\n\r\nMy Youtube channel — [https://www.youtube.com/@thinkthroo](https://www.youtube.com/@thinkthroo)\r\n\r\nLearning platform — [https://thinkthroo.com](https://thinkthroo.com/)\r\n\r\nCodebase Architecture — [https://app.thinkthroo.com/architecture](https://app.thinkthroo.com/architecture)\r\n\r\nBest practices — [https://app.thinkthroo.com/best-practices](https://app.thinkthroo.com/best-practices)\r\n\r\nProduction-grade projects — [https://app.thinkthroo.com/production-grade-projects](https://app.thinkthroo.com/production-grade-projects)\r\n\r\n# **References:**\r\n\r\n1. [https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts](https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts)\r\n    \r\n2. [https://github.com/search?q=repo%3Atrpc%2Ftrpc%20getRollupConfig&type=code](https://github.com/search?q=repo%3Atrpc%2Ftrpc+getRollupConfig&type=code)\r\n    \r\n3. [https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/packages/client/rollup.config.ts#L3](https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/packages/client/rollup.config.ts#L3)\r\n    \r\n4. [https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/scripts/getRollupConfig.ts#L9](https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/scripts/getRollupConfig.ts#L9)\r\n    \r\n5. [https://www.npmjs.com/package/rollup-plugin-analyzer#options](https://www.npmjs.com/package/rollup-plugin-analyzer#options) ",
    "code": "var Component=(()=>{var h=Object.create;var a=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var f=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),y=(t,e)=>{for(var r in e)a(t,r,{get:e[r],enumerable:!0})},l=(t,e,r,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let i of m(e))!g.call(t,i)&&i!==r&&a(t,i,{get:()=>e[i],enumerable:!(c=u(e,i))||c.enumerable});return t};var z=(t,e,r)=>(r=t!=null?h(b(t)):{},l(e||!t||!t.__esModule?a(r,\"default\",{value:t,enumerable:!0}):r,t)),w=t=>l(a({},\"__esModule\",{value:!0}),t);var s=f((N,o)=>{o.exports=_jsx_runtime});var C={};y(C,{default:()=>p,frontmatter:()=>k});var n=z(s()),k={title:\"rollup-plugin-analyzer usage in trpc scripts\"};function d(t){let e={a:\"a\",br:\"br\",code:\"code\",div:\"div\",h1:\"h1\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...t.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"In the previous article, we provided a mental picture of functions in \",(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts\",children:\"analyzeSizeChange.ts file\"}),\", In this article, let\\u2019s find out how the actual size change is analyzed.\"]}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"import analyze from 'rollup-plugin-analyzer';\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"export default function analyzeSizeChange(packageDir: string) {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" let analyzePluginIterations = 0;\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" return analyze({\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   summaryOnly: process.env.CI ? undefined : true,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   skipFormatted: process.env.CI ? true : undefined,\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   onAnalysis: (analysis) => {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   },\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" });\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"}\"})})]})})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"analyze\"}),\" is imported from \",(0,n.jsx)(e.code,{children:\"rollup-plugin-analyzer\"}),\". It\\u2019s got an object as param with \",(0,n.jsx)(e.a,{href:\"https://www.npmjs.com/package/rollup-plugin-analyzer#options\",children:\"options\"}),\":\"]}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"summaryOnly \\u2014 Only output bundle summary and module usage bar graphs\"}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"skipFormatted \\u2014 Don\\u2019t output formatted string\"}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:\"onAnalysis \\u2014 Callback to be invoked with analysis object (I copied the below description for onAnalysis from npm:)\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"function will be invoked with:\",(0,n.jsx)(e.br,{}),`\n`,\"- analysisObject (Object)\",(0,n.jsx)(e.br,{}),`\n`,\"- bundleSize (Number) \\u2014 rendered bundle size in bytes\",(0,n.jsx)(e.br,{}),`\n`,\"- bundleOrigSize (Number) \\u2014 original bundle size in bytes\",(0,n.jsx)(e.br,{}),`\n`,\"- bundleReduction (Number) \\u2014 percentage of rendered bundle size reduction\",(0,n.jsx)(e.br,{}),`\n`,\"- moduleCount (Number) \\u2014 Count of all included modules\",(0,n.jsx)(e.br,{}),`\n`,\"- modules (Array) \\u2014 array of module analysis objects\",(0,n.jsx)(e.br,{}),`\n`,\"- module (Object)\",(0,n.jsx)(e.br,{}),`\n`,\"- id (String) \\u2014 path of module / rollup module id\",(0,n.jsx)(e.br,{}),`\n`,\"- size (Number) \\u2014 size of rendered module code in bytes\",(0,n.jsx)(e.br,{}),`\n`,\"- origSize (Number) \\u2014 size of module\\u2019s original code in bytes\",(0,n.jsx)(e.br,{}),`\n`,\"- dependents (Array) \\u2014 list of dependent module ids / paths\",(0,n.jsx)(e.br,{}),`\n`,\"- percent (Number) \\u2014 percentage of module size relative to entire bundle\",(0,n.jsx)(e.br,{}),`\n`,\"- reduction (Number) \\u2014 percentage of rendered size reduction\",(0,n.jsx)(e.br,{}),`\n`,\"- renderedExports (Array) \\u2014 list of used named exports\",(0,n.jsx)(e.br,{}),`\n`,\"- removedExports (Array) \\u2014 list of unused named exports\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let\\u2019s see how many of these options are actually used in \",(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts\",children:\"analyzeSizeChange file.\"}),(0,n.jsx)(e.br,{}),`\n`,\"- \",(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts#L36\",children:\"bundleSize\"}),(0,n.jsx)(e.br,{}),`\n`,\"- \",(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts#L38\",children:\"modules\"})]}),`\n`,(0,n.jsx)(e.p,{children:\"Just these are found to be used in analyzeSizeChange.ts\"}),`\n`,(0,n.jsx)(e.p,{children:\"But in what circumstances is this script executed? is it after you check in some code? does it report on a pull request? To find that out, we need to go where the code takes us.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"You would have to first search for \",(0,n.jsx)(e.code,{children:\"analyzeSizeChange\"}),\" to see where it is used. It is found to be used in \",(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/scripts/getRollupConfig.ts#L9\",children:\"script/getRollupConfig.ts\"})]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://miro.medium.com/v2/resize:fit:875/1*RPGfbTRlwfJg8rhGwP-Pvg.png\",alt:\"\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Next, you would have to find out where getRollupConfig is used. It is used in a lot of \",(0,n.jsx)(e.a,{href:\"https://github.com/search?q=repo%3Atrpc%2Ftrpc+getRollupConfig&type=code\",children:\"packages\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://miro.medium.com/v2/resize:fit:875/1*zM814-Ubj1vNcOgzudevBw.png\",alt:\"\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"but I picked \",(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/packages/client/rollup.config.ts#L3\",children:\"packages/client/rollup.config.ts\"}),\", this rollup config is used in the build script.\"]}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:'\"scripts\": {'})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:' \"build\": \"rollup - config rollup.config.ts - configPlugin rollup-plugin-swc3\",'})})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"So the answer, you will have the bundle size changes when you build a package in tRPC source code.\"}),`\n`,(0,n.jsx)(e.h1,{id:\"about-me\",children:(0,n.jsx)(e.strong,{children:\"About me:\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Hey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I am open to work on interesting projects. Send me an email at \",(0,n.jsx)(e.a,{href:\"mailto:ramu.narasinga@gmail.com\",children:\"ramu.narasinga@gmail.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My Github \\u2014 \",(0,n.jsx)(e.a,{href:\"https://github.com/ramu-narasinga\",children:\"https://github.com/ramu-narasinga\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My website \\u2014 \",(0,n.jsx)(e.a,{href:\"https://ramunarasinga.com/\",children:\"https://ramunarasinga.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My Youtube channel \\u2014 \",(0,n.jsx)(e.a,{href:\"https://www.youtube.com/@thinkthroo\",children:\"https://www.youtube.com/@thinkthroo\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Learning platform \\u2014 \",(0,n.jsx)(e.a,{href:\"https://thinkthroo.com/\",children:\"https://thinkthroo.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Codebase Architecture \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/architecture\",children:\"https://app.thinkthroo.com/architecture\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Best practices \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/best-practices\",children:\"https://app.thinkthroo.com/best-practices\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Production-grade projects \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/production-grade-projects\",children:\"https://app.thinkthroo.com/production-grade-projects\"})]}),`\n`,(0,n.jsx)(e.h1,{id:\"references\",children:(0,n.jsx)(e.strong,{children:\"References:\"})}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts\",children:\"https://github.com/trpc/trpc/blob/next/scripts/analyzeSizeChange.ts\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/search?q=repo%3Atrpc%2Ftrpc+getRollupConfig&type=code\",children:\"https://github.com/search?q=repo%3Atrpc%2Ftrpc%20getRollupConfig&type=code\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/packages/client/rollup.config.ts#L3\",children:\"https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/packages/client/rollup.config.ts#L3\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/scripts/getRollupConfig.ts#L9\",children:\"https://github.com/trpc/trpc/blob/3388c9691d122b9d4047b2de0caedcdf611354ab/scripts/getRollupConfig.ts#L9\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://www.npmjs.com/package/rollup-plugin-analyzer#options\",children:\"https://www.npmjs.com/package/rollup-plugin-analyzer#options\"})}),`\n`]}),`\n`]})]})}function p(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,{...t,children:(0,n.jsx)(d,{...t})}):d(t)}return w(C);})();\n;return Component;"
  },
  "_id": "blog/rollup-plugin-analyzer-usage.mdx",
  "_raw": {
    "sourceFilePath": "blog/rollup-plugin-analyzer-usage.mdx",
    "sourceFileName": "rollup-plugin-analyzer-usage.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/rollup-plugin-analyzer-usage"
  },
  "type": "Doc",
  "slug": "/blog/rollup-plugin-analyzer-usage",
  "slugAsParams": "rollup-plugin-analyzer-usage"
}