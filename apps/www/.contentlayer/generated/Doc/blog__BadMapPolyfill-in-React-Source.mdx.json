{
  "title": "BadMapPolyfill in React Source Code.\r",
  "published": false,
  "featured": false,
  "component": false,
  "toc": true,
  "body": {
    "raw": "\r\nIn this article, we study the [packages/react/src/BadMapPolyfill.js](https://github.com/facebook/react/blob/main/packages/react/src/BadMapPolyfill.js) file source code.\r\n\r\n```plaintext\r\n/**\r\n * Copyright © Meta Platforms, Inc. and affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n * @flow\r\n */\r\nexport let hasBadMapPolyfill: boolean;\r\n  if (__DEV__) {\r\n   hasBadMapPolyfill = false;\r\n   try {\r\n     const frozenObject = Object.freeze({});\r\n     /* eslint-disable no-new */\r\n     new Map([[frozenObject, null]]);\r\n     new Set([frozenObject]);\r\n     /* eslint-enable no-new */\r\n   } catch (e) {\r\n     // TODO: Consider warning about bad polyfills\r\n     hasBadMapPolyfill = true;\r\n }\r\n}\r\n```\r\n\r\nMap’s been available across browsers since July 2015. The Map object holds key-value pairs and remembers the original insertion order of the keys.\r\n\r\nThis code above tries to create a new Map and new Set in a try block and if it fails, it is caught in the catch block and `hasBadMapPolyfill` set to true, otherwise `hasBadMapPolyfill` remains false.\r\n\r\n# **eslint-enable no-new**\r\n\r\n[ESLint docs](https://eslint.org/docs/latest/rules/no-new) states that no-new disallows new operators outside of assignments or comparisons. The goal of using new with a constructor is typically to create an object of a particular type and store that object in a variable, such as:\r\n\r\n```plaintext\r\nvar person = new Person();\r\n```\r\n\r\nIt’s less common to use new and not store the result, such as:\r\n\r\n```plaintext\r\nnew Person();\r\n```\r\n\r\nThis rule is aimed at maintaining consistency and convention by disallowing constructor calls using the new keyword that do not assign the resulting object to a variable.\r\n\r\n# **Map and Set pollyfills:**\r\n\r\n[Map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map) in MDN docs provides a link to Map polyfill available in [core-js](https://github.com/zloirock/core-js#map)\r\n\r\n[Set](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set) in MDN docs provides a link to Map polyfill available in [core-js](https://github.com/zloirock/core-js#set)\r\n\r\n## **Where is this hasBadMapPollyfill used?**\r\n\r\nhasBadMapPollyfill is used in [/packages/react-reconciler/src/ReactFiber.js](https://github.com/facebook/react/blob/5d19e1c8d1a6c0b5cd7532d43b707191eaf105b7/packages/react-reconciler/src/ReactFiber.js#L122-L134)\r\n\r\nExcept the code you see in BadMapPollyfill is written here again. I do not know the reason why.\r\n\r\n![](https://miro.medium.com/v2/resize:fit:875/1*NAOSiNaRo0ZDBJ9UjCb5BA.png)\r\n\r\n# **About me:**\r\n\r\nHey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\r\n\r\nI am open to work on interesting projects. Send me an email at ramu.narasinga@gmail.com\r\n\r\nMy Github — [https://github.com/ramu-narasinga](https://github.com/ramu-narasinga)\r\n\r\nMy website — [https://ramunarasinga.com](https://ramunarasinga.com/)\r\n\r\nMy Youtube channel — [https://www.youtube.com/@thinkthroo](https://www.youtube.com/@thinkthroo)\r\n\r\nLearning platform — [https://thinkthroo.com](https://thinkthroo.com/)\r\n\r\nCodebase Architecture — [https://app.thinkthroo.com/architecture](https://app.thinkthroo.com/architecture)\r\n\r\nBest practices — [https://app.thinkthroo.com/best-practices](https://app.thinkthroo.com/best-practices)\r\n\r\nProduction-grade projects — [https://app.thinkthroo.com/production-grade-projects](https://app.thinkthroo.com/production-grade-projects)\r\n\r\n# **References:**\r\n\r\n1. [https://github.com/facebook/react/blob/main/packages/react/src/BadMapPolyfill.js](https://github.com/facebook/react/blob/main/packages/react/src/BadMapPolyfill.js)\r\n    \r\n2. [https://eslint.org/docs/latest/rules/no-new](https://eslint.org/docs/latest/rules/no-new)\r\n    \r\n3. [https://developer.mozilla.org/en-US/docs/Glossary/Polyfill](https://developer.mozilla.org/en-US/docs/Glossary/Polyfill)\r\n    \r\n4. [https://github.com/search?q=repo%3Afacebook%2Freact%20hasBadMapPolyfill&type=code](https://github.com/search?q=repo%3Afacebook%2Freact+hasBadMapPolyfill&type=code)\r\n    \r\n5. [https://github.com/facebook/react/blob/5d19e1c8d1a6c0b5cd7532d43b707191eaf105b7/packages/react-reconciler/src/ReactFiber.js#L207](https://github.com/facebook/react/blob/5d19e1c8d1a6c0b5cd7532d43b707191eaf105b7/packages/react-reconciler/src/ReactFiber.js#L207)\r\n    \r\n6. [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global\\_Objects/Map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)\r\n    \r\n7. [https://github.com/zloirock/core-js#map](https://github.com/zloirock/core-js#map)\r\n    \r\n8. [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global\\_Objects/Set](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set)\r\n    \r\n9. [https://github.com/zloirock/core-js#set](https://github.com/zloirock/core-js#set)\r\n",
    "code": "var Component=(()=>{var p=Object.create;var t=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var f=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var g=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),y=(a,e)=>{for(var l in e)t(a,l,{get:e[l],enumerable:!0})},c=(a,e,l,i)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of b(e))!u.call(a,r)&&r!==l&&t(a,r,{get:()=>e[r],enumerable:!(i=m(e,r))||i.enumerable});return a};var j=(a,e,l)=>(l=a!=null?p(f(a)):{},c(e||!a||!a.__esModule?t(l,\"default\",{value:a,enumerable:!0}):l,a)),k=a=>c(t({},\"__esModule\",{value:!0}),a);var o=g((N,s)=>{s.exports=_jsx_runtime});var M={};y(M,{default:()=>d,frontmatter:()=>w});var n=j(o()),w={title:\"BadMapPolyfill in React Source Code.\"};function h(a){let e={a:\"a\",code:\"code\",div:\"div\",h1:\"h1\",h2:\"h2\",img:\"img\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",...a.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"In this article, we study the \",(0,n.jsx)(e.a,{href:\"https://github.com/facebook/react/blob/main/packages/react/src/BadMapPolyfill.js\",children:\"packages/react/src/BadMapPolyfill.js\"}),\" file source code.\"]}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsxs)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:[(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"/**\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" * Copyright \\xA9 Meta Platforms, Inc. and affiliates.\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" *\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" * This source code is licensed under the MIT license found in the\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" * LICENSE file in the root directory of this source tree.\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" * @flow\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" */\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"export let hasBadMapPolyfill: boolean;\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"  if (__DEV__) {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   hasBadMapPolyfill = false;\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   try {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"     const frozenObject = Object.freeze({});\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"     /* eslint-disable no-new */\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"     new Map([[frozenObject, null]]);\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"     new Set([frozenObject]);\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"     /* eslint-enable no-new */\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"   } catch (e) {\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"     // TODO: Consider warning about bad polyfills\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"     hasBadMapPolyfill = true;\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\" }\"})}),`\n`,(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"}\"})})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Map\\u2019s been available across browsers since July 2015. The Map object holds key-value pairs and remembers the original insertion order of the keys.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"This code above tries to create a new Map and new Set in a try block and if it fails, it is caught in the catch block and \",(0,n.jsx)(e.code,{children:\"hasBadMapPolyfill\"}),\" set to true, otherwise \",(0,n.jsx)(e.code,{children:\"hasBadMapPolyfill\"}),\" remains false.\"]}),`\n`,(0,n.jsx)(e.h1,{id:\"eslint-enable-no-new\",children:(0,n.jsx)(e.strong,{children:\"eslint-enable no-new\"})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://eslint.org/docs/latest/rules/no-new\",children:\"ESLint docs\"}),\" states that no-new disallows new operators outside of assignments or comparisons. The goal of using new with a constructor is typically to create an object of a particular type and store that object in a variable, such as:\"]}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsx)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"var person = new Person();\"})})})})}),`\n`,(0,n.jsx)(e.p,{children:\"It\\u2019s less common to use new and not store the result, such as:\"}),`\n`,(0,n.jsx)(e.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,n.jsx)(e.pre,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsx)(e.code,{\"data-language\":\"plaintext\",\"data-theme\":\"default\",children:(0,n.jsx)(e.span,{className:\"line\",children:(0,n.jsx)(e.span,{children:\"new Person();\"})})})})}),`\n`,(0,n.jsx)(e.p,{children:\"This rule is aimed at maintaining consistency and convention by disallowing constructor calls using the new keyword that do not assign the resulting object to a variable.\"}),`\n`,(0,n.jsx)(e.h1,{id:\"map-and-set-pollyfills\",children:(0,n.jsx)(e.strong,{children:\"Map and Set pollyfills:\"})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map\",children:\"Map\"}),\" in MDN docs provides a link to Map polyfill available in \",(0,n.jsx)(e.a,{href:\"https://github.com/zloirock/core-js#map\",children:\"core-js\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set\",children:\"Set\"}),\" in MDN docs provides a link to Map polyfill available in \",(0,n.jsx)(e.a,{href:\"https://github.com/zloirock/core-js#set\",children:\"core-js\"})]}),`\n`,(0,n.jsx)(e.h2,{id:\"where-is-this-hasbadmappollyfill-used\",children:(0,n.jsx)(e.strong,{children:\"Where is this hasBadMapPollyfill used?\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"hasBadMapPollyfill is used in \",(0,n.jsx)(e.a,{href:\"https://github.com/facebook/react/blob/5d19e1c8d1a6c0b5cd7532d43b707191eaf105b7/packages/react-reconciler/src/ReactFiber.js#L122-L134\",children:\"/packages/react-reconciler/src/ReactFiber.js\"})]}),`\n`,(0,n.jsx)(e.p,{children:\"Except the code you see in BadMapPollyfill is written here again. I do not know the reason why.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://miro.medium.com/v2/resize:fit:875/1*NAOSiNaRo0ZDBJ9UjCb5BA.png\",alt:\"\"})}),`\n`,(0,n.jsx)(e.h1,{id:\"about-me\",children:(0,n.jsx)(e.strong,{children:\"About me:\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Hey, my name is Ramu Narasinga. I study large open-source projects and create content about their codebase architecture and best practices, sharing it through articles, videos.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I am open to work on interesting projects. Send me an email at \",(0,n.jsx)(e.a,{href:\"mailto:ramu.narasinga@gmail.com\",children:\"ramu.narasinga@gmail.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My Github \\u2014 \",(0,n.jsx)(e.a,{href:\"https://github.com/ramu-narasinga\",children:\"https://github.com/ramu-narasinga\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My website \\u2014 \",(0,n.jsx)(e.a,{href:\"https://ramunarasinga.com/\",children:\"https://ramunarasinga.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"My Youtube channel \\u2014 \",(0,n.jsx)(e.a,{href:\"https://www.youtube.com/@thinkthroo\",children:\"https://www.youtube.com/@thinkthroo\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Learning platform \\u2014 \",(0,n.jsx)(e.a,{href:\"https://thinkthroo.com/\",children:\"https://thinkthroo.com\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Codebase Architecture \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/architecture\",children:\"https://app.thinkthroo.com/architecture\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Best practices \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/best-practices\",children:\"https://app.thinkthroo.com/best-practices\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Production-grade projects \\u2014 \",(0,n.jsx)(e.a,{href:\"https://app.thinkthroo.com/production-grade-projects\",children:\"https://app.thinkthroo.com/production-grade-projects\"})]}),`\n`,(0,n.jsx)(e.h1,{id:\"references\",children:(0,n.jsx)(e.strong,{children:\"References:\"})}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/facebook/react/blob/main/packages/react/src/BadMapPolyfill.js\",children:\"https://github.com/facebook/react/blob/main/packages/react/src/BadMapPolyfill.js\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://eslint.org/docs/latest/rules/no-new\",children:\"https://eslint.org/docs/latest/rules/no-new\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Glossary/Polyfill\",children:\"https://developer.mozilla.org/en-US/docs/Glossary/Polyfill\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/search?q=repo%3Afacebook%2Freact+hasBadMapPolyfill&type=code\",children:\"https://github.com/search?q=repo%3Afacebook%2Freact%20hasBadMapPolyfill&type=code\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/facebook/react/blob/5d19e1c8d1a6c0b5cd7532d43b707191eaf105b7/packages/react-reconciler/src/ReactFiber.js#L207\",children:\"https://github.com/facebook/react/blob/5d19e1c8d1a6c0b5cd7532d43b707191eaf105b7/packages/react-reconciler/src/ReactFiber.js#L207\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map\",children:\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/zloirock/core-js#map\",children:\"https://github.com/zloirock/core-js#map\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set\",children:\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/zloirock/core-js#set\",children:\"https://github.com/zloirock/core-js#set\"})}),`\n`]}),`\n`]})]})}function d(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,{...a,children:(0,n.jsx)(h,{...a})}):h(a)}return k(M);})();\n;return Component;"
  },
  "_id": "blog/BadMapPolyfill-in-React-Source.mdx",
  "_raw": {
    "sourceFilePath": "blog/BadMapPolyfill-in-React-Source.mdx",
    "sourceFileName": "BadMapPolyfill-in-React-Source.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/BadMapPolyfill-in-React-Source"
  },
  "type": "Doc",
  "slug": "/blog/BadMapPolyfill-in-React-Source",
  "slugAsParams": "BadMapPolyfill-in-React-Source"
}